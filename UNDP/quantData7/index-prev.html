<!DOCTYPE html>
<html>
    <head>
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <!--<script src="d3CheckBox.js"></script>-->
        </head>
        <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Roboto:100,300" rel="stylesheet">
        <style type="text/css">
            
            
            #regions {
               position: relative;
               margin-left: 40px;
               background: white;
               width: 150px;
               padding: 20px;
               font-size: 10px;
               height: 25px;
            }
            
            body {
                background-color: black;
            }
            
           div.tooltip {	
                position: absolute;
                text-align: left;			
                width: 120px;					
                height: 80px;					
                padding: 10px;				
                font: 12px sans-serif;		
                background: white;	
                border-width: 2px;		
                border-radius: 2px;
                box-shadow: 0px 0px 10px #888888;
                border-style: solid;
                border-color: white transparent transparent transparent;
                }
            
            #option {	
                position: absolute;	
                margin-left: 40px;
                text-align: center;
                font: 12px sans-serif;		
                border: 0px;
                margin-top: 50px;
                }
            
            #canvas {	
                
                margin-top: 40px;
                
                }    
            
            #start {	
                position: absolute;	
                text-align: center;
                margin-left: 50px;
                font-size: 10px;
                cursor: pointer;
                }    
                
            
            p {
                    font-family: 'Roboto', sans-serif;
                    font-weight: 300;
                    font-size: 10px;
                    color: LightGrey;
                    margin-left: 50px;
                }
            
            
            h1 {
                    font-family: 'Roboto', sans-serif;
                    font-weight:300;
                    color: rgb(9,166,163);
                    margin-left: 50px;
                }
        </style>
        <body>
            
        <h1>The African Education Enrolment Funnel</h1>    
        
        <p>Over the past decade, the primary school enrolment rate has <br>significantly improved in sub-Saharan Africa, now averaging over 80%.</p>
        <p>However, the poor secondary and tertiary enrolment rates are considerably restricting <br>the region from moving it's economy toward higher-productivity sectors.</p>
        <p>This visualization is an attempt to establish this gap in the different levels of education. <br>The enrolment rates displayed below are averaged over the ten year peiod, from 2004 to 2014.</p>
        
        <div id="start">
            <input name="start" 
                   type="button" 
                   value="Begin" 
                   onclick="begin()" /></div> 
        
        
        
        <svg id = "canvas"></svg>
        
        <div id="option" style="height: 20px">
            <input name="updateButton" 
                   type="button" 
                   value="Expand scale x10" 
                   onclick="expand()" />
        </div>  
        <script>
        
            // setting margin
            var margin = {top: 30, right: 0, bottom: 60, left: 50},
            width = window.innerWidth - margin.left - margin.right,
            height = window.innerHeight - 100 - margin.bottom;
            
            // // Header
            // var header = d3.select("body")
            //                 .append('h2')
            //                 .text("The African education enrolment funnel");
            
            // // First Paragraph
            // var p1 = d3.select("body")
            //             .append("p")
            //             .html("Does the enrolment rate in different levels of education have a direct impact on the economy?" + "<br>"  + "This visualization attempts to understand the state of education enrolment <b> (averaged over 2004-2014) </b><br> across all  African nations and juxtapose those numbers with different economic indicators <b> (2014 values) </b> <br>to establish how the two relate with each other.");
            
            // Regions drop down
            
            var regions = ["All countries", "Eastern Africa", "Western Africa", "Middle Africa", "Southern Africa", "Northern Africa"];

            var sel2 = d3.select("body")
                        .append("select")
                        .attr('id', 'regions')
                        .selectAll("option")
                        .data(regions)
                        .enter()
                        .append("option")
                        .text(function(d) {return d;});    
            
            var canvas = d3.select("#canvas")
                            .attr("width", width)
                            .attr("height", height);
            
            createAxes();

            //Container for the gradients
                var defs = canvas.append("defs");
                
                // //Filter for the outside glow
                // var filter = defs.append("filter")
                // 	.attr("id","glow");
                // filter.append("feGaussianBlur")
                // 	.attr("stdDeviation","4.5")
                // 	.attr("result","coloredBlur");
                // var feMerge = filter.append("feMerge");
                // feMerge.append("feMergeNode")
                // 	.attr("in","coloredBlur");
                // feMerge.append("feMergeNode")
                // 	.attr("in","SourceGraphic");

            
            var filtData = [];
            function firstVisual(){
                d3.csv("quantData.csv", function(error, data) {
                if (error) throw error;
                console.log(data);
                
                var funnelGroup2 = canvas.selectAll('.funnelGroup2')
                                        .data(data)
                                        .enter()
                                        .append('g'); 
                
                  
                    var primary1 = funnelGroup2
                                    .append("circle")
                                    .attr("class", "funnelGroup2")
                                    .attr('cx', function(d, i) { return width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20;})
                                    .attr('cy', 20)
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3);
                                    
                    var primary2 = funnelGroup2
                                    .append("circle")
                                    .attr("class", "funnelGroup2")
                                    .attr('cx', function(d, i) { return width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20;})
                                    .attr('cy', 20)
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3);    
                                    
                    var check = funnelGroup2
                                    .append("rect")
                                    .attr("class", "funnelGroup2")
                                    .attr('x', function(d, i) { return width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20;})
                                    .attr('y', 19)
                                    .attr('width', function(d, i) { return (width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20 - (width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20));})
                                    .attr('height', 2)
                                    .style("fill", "white")
                                    .attr('fill-opacity', 0)
                                    ;                
                  
                
                
                    
                    var secondary1 = funnelGroup2
                                    .append("circle")
                                    .attr("class", "funnelGroup2")
                                    .attr('cx', function(d, i) { return width/2 + parseFloat(mapX2(d['enrolSecondary']))/2 - 20;})
                                    .attr('cy', function(d, i) { if(d['enrolSecondary'] !== ""){return height/2;}else{return 10000;}})
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3); 
                    var secondary2 = funnelGroup2
                                    .append("circle")
                                    .attr("class", "funnelGroup2")
                                    .attr('cx', function(d, i) { return width/2 - parseFloat(mapX2(d['enrolSecondary']))/2 + 20;})
                                    .attr('cy', function(d, i) { if(d['enrolSecondary'] !== ""){return height/2;}else{return 10000;}})
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3);
                                    
                    var primSec1 = funnelGroup2
                                    .append("line")
                                    .attr("class", "funnelGroup2")
                                    .attr("x1", function(d, i) { return width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20 ;})
                                    .attr("y1", function(d, i) { if(d['enrolSecondary'] !== ""){return 20;}else{return 10000;}})
                                    .attr("x2", function(d, i) { return width/2 + parseFloat(mapX2(d['enrolSecondary']))/2 - 20 ;})
                                    .attr("y2", function(d, i) { if(d['enrolSecondary'] !== ""){return height/2;}else{return 10000;}})
                                    .attr("stroke-width", 0.25)
                                    .attr("stroke-opacity", 0.5)
                                    .attr("stroke", "LightGrey")
                                    ;
                                    
                    var primSec2 = funnelGroup2
                                    .append("line")
                                    .attr("class", "funnelGroup2")
                                    .attr("x1", function(d, i) {return width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20; })
                                    .attr("y1", function(d, i) { if(d['enrolSecondary'] !== ""){return 20;}else{return 10000;}})
                                    .attr("x2", function(d, i) {return width/2 - parseFloat(mapX2(d['enrolSecondary']))/2  + 20;})
                                    .attr("y2", function(d, i) { if(d['enrolSecondary'] !== ""){return height/2;}else{return 10000;}})
                                    .attr("stroke-width", 0.25)
                                    .attr("stroke-opacity", 0.5)
                                    .attr("stroke", "LightGrey")
                                    ;

                
                
                    
                    var tertiary1 = funnelGroup2
                                    .append("circle")
                                    .attr("class", "funnelGroup2")
                                    .attr('cx', function(d, i) { if(d['enrolTertiary'] !== ""){return width/2 + parseFloat(mapX3(d['enrolTertiary']))/2 - 20;}})
                                    .attr('cy', function(d, i) { if(d['enrolTertiary'] !== ""){return height - 40;}else{return 10000;}})
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3);
                    var tertiary2 = funnelGroup2
                                    .append("circle")
                                    .attr("class", "funnelGroup2")
                                    .attr('cx', function(d, i) { if(d['enrolTertiary'] !== ""){return width/2 - parseFloat(mapX3(d['enrolTertiary']))/2 + 20;}})
                                    .attr('cy', function(d, i) { if(d['enrolTertiary'] !== ""){return height - 40;}else{return 10000;}})
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3);                
                                    
                    
                                    
                    var secTer1 = funnelGroup2
                                    .append("line")
                                    .attr("class", "funnelGroup2")
                                    .attr("x1", function(d, i) { if(d['enrolTertiary'] !== ""){return width/2 + parseFloat(mapX2(d['enrolSecondary']))/2 - 20; }})
                                    .attr("y1", function(d, i) { if(d['enrolTertiary'] !== ""){return height/2;}else{return 10000;}})
                                    .attr("x2", function(d, i) {if(d['enrolTertiary'] !== ""){return width/2 + parseFloat(mapX3(d['enrolTertiary']))/2 - 20;} })
                                    .attr("y2", function(d, i) { if(d['enrolTertiary'] !== ""){return height - 40;}else{return 10000;}})
                                    .attr("stroke-width", 0.25)
                                    .attr("stroke-opacity", 0.5)
                                    .attr("stroke", "LightGrey")
                                    ;
                                    
                                    
                    var secTer2 = funnelGroup2
                                    .append("line")
                                    .attr("class", "funnelGroup2")
                                    .attr("x1", function(d, i) { if(d['enrolTertiary'] !== ""){ return width/2 - parseFloat(mapX2(d['enrolSecondary']))/2 + 20; }})
                                    .attr("y1", function(d, i) { if(d['enrolTertiary'] !== ""){return height/2;}else{return 10000;}})
                                    .attr("x2", function(d, i) { if(d['enrolTertiary'] !== ""){ return width/2 - parseFloat(mapX3(d['enrolTertiary']))/2 + 20;} })
                                    .attr("y2", function(d, i) { if(d['enrolTertiary'] !== ""){return height - 40;}else{return 10000;}})
                                    .attr("stroke-width", 0.25)
                                    .attr("stroke-opacity", 0.5)
                                    .attr("stroke", "LightGrey")
                                    ;
                    
                    
                    var tooltip =  funnelGroup2 
                                    .on("mouseover", function(d) 
                                        {
                                        d3.select(this).selectAll("circle").style("stroke", 'rgb(180, 180, 180)').style("stroke-width", "2.5").style("fill-opacity", "1"); d3.select(this).selectAll("line").style("stroke", "white").style("stroke-width", "2").style("stroke-opacity", "1");
                                        d3.select(this).selectAll("rect").style("fill-opacity", "1");
                                        div.transition()		
                                            .duration(200)		
                                            .style("opacity", .9);
                                            
                                        var primColor, secColor, terColor;
                                    if(d['enrolPrimary'] >= 91.97){primColor = 'green';}else{ primColor = 'red'};
                                    if(d['enrolSecondary'] >= d['enrolSecondaryAvg']){secColor = 'green';}else{ secColor = 'red'};
                                    if(d['enrolTertiary'] >= 8.39){terColor = 'green';}else{ terColor = 'red'};
                                        
                                    div.html("<span style='font-size: 15px; text-align: left; text-transform: uppercase'>" + "<b>" + d['country'] + "</b> </span> <br>" 
                                                         // + "</span>" + "<br>" + "<span> <br> Primary:   </span>"+  "<b>"+ "<span style = 'color: " + primColor + "'>"  + d['enrolPrimary'] + "%" +  " </span> </b>"
                                                          + "<br>" + " Primary:  <b>" + "<span style='color: " + primColor + "'>" + d['enrolPrimary'] + "%" + "</span> </b>"
                                                          + "<br>" + " Secondary:  <b>" + "<span style='color: " + secColor + "'>" + d['enrolSecondary'] + "%" + "</span> </b>"
                                                          + "<br>" + " Tertiary: <b>" + "<span style='color: " + terColor + "'>" + d['enrolTertiary'] + "%" + "</span> </b>")	
                                        .style("left", (d3.event.pageX - 100) + "px")		
                                            .style("top", (d3.event.pageY - 130) + "px");
                                        })
                                    .on("mouseout", function() {
                                        d3.select(this).selectAll("circle").style("stroke", 'white').style("stroke-width", "0").style("fill-opacity", "0.3");
                                        d3.select(this).selectAll("line").style("stroke-width", "0.3").style("stroke-opacity", "0.5").style("stroke", "grey");
                                        d3.select(this).selectAll("rect").style("fill-opacity", "0");
                                        div.transition()		
                                            .duration(500)		
                                            .style("opacity", 0);	
                                    });
                                    
                d3.select("#regions").on("change",function(){
                filtData = [];
                
                for(var i = 0; i<data.length; i++){
                    if(regions[this.selectedIndex] == data[i]['subRegion']){
                     filtData.push(data[i]);   
                    }
                }
                console.log(filtData);
                d3.selectAll("#funnelgrp").remove();
                changeVisual(filtData);
                });
                
            }); //function(err, data) ends 
            }
                
            var mapX1 = d3.scaleLinear().domain([0, 100]).range([50, width - 50]);
            var mapX2 = d3.scaleLinear().domain([0, 100]).range([50, width - 50]);   
            var mapX3 = d3.scaleLinear().domain([0, 100]).range([50, width - 50]);  
            
            var div = d3.select("body").append("div")	
                                    .attr("class", "tooltip")				
                                    .style("opacity", 0)
                                    .attr("x", "200");
                                    
            function createAxes(){
    
    // ------------- create axis ONE -------------------------------- 
                
                var axis1 = canvas
                                .append("line")
                                .attr("x1", 40 )
                                .attr("y1", 20)
                                .attr("x2", width - 40)
                                .attr("y2", 20)
                                .attr("stroke-width", 0.5)
                                .attr("stroke", "LightGrey");
                                
                            canvas
                                .append("line")
                                .attr("x1", 40 )
                                .attr("y1", 20 - 5)
                                .attr("x2", 40)
                                .attr("y2", 20 + 5)
                                .attr("stroke-width", 1)
                                .attr("stroke", "white");
      
                            canvas
                                .append("line")
                                .attr("x1", width - 40 )
                                .attr("y1", 20 - 5)
                                .attr("x2", width - 40)
                                .attr("y2", 20 + 5)
                                .attr("stroke-width", 1)
                                .attr("stroke", "white");
                            
                            canvas
                                .append("line")
                                .attr("x1", width/2 )
                                .attr("y1", 20 - 5)
                                .attr("x2", width/2)
                                .attr("y2", 20 + 5)
                                .attr("stroke-width", 1)
                                .attr("stroke", "white");    
                                
                            canvas
                                .append("text")
                                .attr("x", 40)
                                .attr("y", 20 + 20)
                                .text("50%")
                                .attr("text-anchor", "middle")
                                .attr("font-family", "'Roboto', sans-serif")
                                .attr("font-weight", "300")
                                .attr("font-size", "12")
                                .attr("fill", "LightGrey");
                                
                            canvas
                                .append("text")
                                .attr("x", width - 40)
                                .attr("y", 20 + 20)
                                .text("50%")
                                .attr("text-anchor", "middle")
                                .attr("font-family", "'Roboto', sans-serif")
                                .attr("font-weight", "300")
                                .attr("font-size", "12")
                                .attr("fill", "LightGrey"); 
                                
                             canvas
                                .append("text")
                                .attr("x", width/2)
                                .attr("y", 20 + 20)
                                .attr("text-anchor", "middle")
                                .text("primary enrolment")
                                .attr("font-family", "'Roboto', sans-serif")
                                .attr("font-weight", "300")
                                .attr("font-size", "12")
                                .attr("fill", "LightGrey");    
                 
    
    // ------------- create axis TWO --------------------------------
    
                var axis2 = canvas
                                .append("line")
                                .attr("x1", 40 )
                                .attr("y1", height/2)
                                .attr("x2", width - 40)
                                .attr("y2", height/2)
                                .attr("stroke-width", 0.5)
                                .attr("stroke", "LightGrey");                            
    
                             canvas
                                .append("line")
                                .attr("x1", 40 )
                                .attr("y1", height/2 - 5)
                                .attr("x2", 40)
                                .attr("y2", height/2 + 5)
                                .attr("stroke-width", 1)
                                .attr("stroke", "white"); 
                
                            canvas
                                .append("line")
                                .attr("x1", width - 40 )
                                .attr("y1", height/2 - 5)
                                .attr("x2", width - 40)
                                .attr("y2", height/2 + 5)
                                .attr("stroke-width", 1)
                                .attr("stroke", "white"); 
                            
                            canvas
                                .append("line")
                                .attr("x1", width/2 )
                                .attr("y1", height/2 - 5)
                                .attr("x2", width/2)
                                .attr("y2", height/2 + 5)
                                .attr("stroke-width", 1)
                                .attr("stroke", "white"); 
                                
                            canvas
                                .append("text")
                                .attr("x", 40)
                                .attr("y", height/2 + 20)
                                .text("50%")
                                .attr("text-anchor", "middle")
                                .attr("font-family", "'Roboto', sans-serif")
                                .attr("font-weight", "300")
                                .attr("font-size", "12")
                                .attr("fill", "LightGrey");
                                
                            canvas
                                .append("text")
                                .attr("x", width - 40)
                                .attr("y", height/2 + 20)
                                .text("50%")
                                .attr("text-anchor", "middle")
                                .attr("font-family", "'Roboto', sans-serif")
                                .attr("font-weight", "300")
                                .attr("font-size", "12")
                                .attr("fill", "LightGrey");    
                                
                                
                            canvas
                                .append("text")
                                .attr("x", width/2)
                                .attr("y", height/2 + 20)
                                .attr("text-anchor", "middle")
                                .text("secondary enrolment")
                                .attr("font-family", "'Roboto', sans-serif")
                                .attr("font-weight", "300")
                                .attr("font-size", "12")
                                .attr("fill", "LightGrey");    
                                
                
    // ------------- create axis THREE --------------------------------            
                
                var axis3 = canvas
                                .append("line")
                                .attr("x1", 40 )
                                .attr("y1", height - 40)
                                .attr("x2", width - 40)
                                .attr("y2", height - 40)
                                .attr("stroke-width", 0.5)
                                .attr("stroke", "LightGrey");
                                
                            canvas
                                .append("text")
                                .attr("x", 40)
                                .attr("y", height - 40 + 20 )
                                .text("50%")
                                .attr("text-anchor", "middle")
                                .attr("font-family", "'Roboto', sans-serif")
                                .attr("font-weight", "300")
                                .attr("font-size", "12")
                                .attr("fill", "LightGrey");
                                
                            canvas
                                .append("text")
                                .attr("x", width - 40)
                                .attr("y", height - 40 + 20)
                                .text("50%")
                                .attr("text-anchor", "middle")
                                .attr("font-family", "'Roboto', sans-serif")
                                .attr("font-weight", "300")
                                .attr("font-size", "12")
                                .attr("fill", "LightGrey");                    
                                
                            canvas
                                .append("line")
                                .attr("x1", 40 )
                                .attr("y1", height - 40 - 5)
                                .attr("x2", 40)
                                .attr("y2", height - 40 + 5)
                                .attr("stroke-width", 1)
                                .attr("stroke", "white"); 
                
                            canvas
                                .append("line")
                                .attr("x1", width - 40 )
                                .attr("y1", height - 40 - 5 )
                                .attr("x2", width - 40)
                                .attr("y2", height - 40 + 5 )
                                .attr("stroke-width", 1)
                                .attr("stroke", "white"); 
                            
                            canvas
                                .append("line")
                                .attr("x1", width/2 )
                                .attr("y1", height - 40 - 5)
                                .attr("x2", width/2)
                                .attr("y2", height - 40 + 5)
                                .attr("stroke-width", 1)
                                .attr("stroke", "white");
                                
                            canvas
                                .append("text")
                                .attr("x", width/2)
                                .attr("y", height - 40 + 20 )
                                .text("tertiary enrolment")
                                .attr("text-anchor", "middle")
                                .attr("font-family", "'Roboto', sans-serif")
                                .attr("font-weight", "300")
                                .attr("font-size", "12")
                                .attr("fill", "LightGrey");  
                                
                            
    // ---------------
    
    }
            
            function expand(){
            d3.selectAll(".funnelGroup").remove();
            d3.selectAll(".funnelGroup2").remove();

            var mapX3old = d3.scaleLinear().domain([0, 100]).range([50, width - 50]);
            mapX3 = d3.scaleLinear().domain([0, 10]).range([50, width - 50]);
            
            // use positions from funnel group 2 and transition the funnelGroup two element to x10 times the position and then remove it
            // then add a time delay and run the firstvisual function
            // increase margins from both sides
            // add context at the top
             d3.csv("quantData.csv", function(error, data) {
                if (error) throw error;
            var expandGroup = canvas.selectAll('.expandGroup')
                                        .data(data)
                                        .enter()
                                        .append('g');
            
                    var tertiary1 = expandGroup
                                    .append("circle")
                                    .attr("class", "expandGroup")
                                    .attr('cx', function(d, i) { return width/2 + parseFloat(mapX3old(d['enrolTertiary']))/2 - 20;})
                                    .attr('cy', height - 40)
                                    .attr('r', 7)
                                    .attr('fill', 'grey')
                                    .attr('fill-opacity', 0.3)
                                    .transition()
                                    .duration(1500)
                                    .attr('cy', height - 40)
                                    .attr('cx', function(d, i) { return width/2 + parseFloat(mapX3(d['enrolTertiary']))/2 - 20;})
                                    .remove();
                                    
                    var tertiary2 = expandGroup
                                    .append("circle")
                                    .attr("class", "expandGroup")
                                    .attr('cx', function(d, i) { return width/2 - parseFloat(mapX3old(d['enrolTertiary']))/2 + 20;})
                                    .attr('cy', height - 40)
                                    .attr('r', 7)
                                    .attr('fill', 'grey')
                                    .attr('fill-opacity', 0.3)
                                    .transition()
                                    .duration(1500)
                                    .attr('cy', height - 40)
                                    .attr('cx', function(d, i) { return width/2 - parseFloat(mapX3(d['enrolTertiary']))/2 + 20;})
                                    .remove();
                            
                            
                                    
             }); 
            
            setTimeout(function() { firstVisual(); }, 1500);
           
        }
             
            function begin(){
              
              d3.csv("quantData.csv", function(error, data) {
                if (error) throw error;
              
              var funnelGroup3 = canvas.selectAll('.funnelGroup3')
                                        .data(data)
                                        .enter()
                                        .append('g'); 
                    
                
                    var primary1 = funnelGroup3
                                    .append("circle")
                                    .attr("class", "funnelGroup3")
                                    .attr('cx', function(d, i) { return width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20;})
                                    .attr('cy', 20)
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3)
                                    .transition()
                                    .delay(500)
                                    .duration(1500)
                                    .attr('cy', height/2)
                                    .attr('cx', function(d, i) { return width/2 + parseFloat(mapX2(d['enrolSecondary']))/2 - 20;})
                                    .transition()
                                    .duration(1500)
                                    .attr('cy', height - 40)
                                    .attr('cx', function(d, i) { return width/2 + parseFloat(mapX3(d['enrolTertiary']))/2 - 20;})
                                    .remove();
                    
                    var primary2 = funnelGroup3
                                    .append("circle")
                                    .attr("class", "funnelGroup3")
                                    .attr('cx', function(d, i) { return width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20;})
                                    .attr('cy', 20)
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3)
                                    .transition()
                                    .delay(500)
                                    .duration(1500)
                                    .attr('cy', height/2)
                                    .attr('cx', function(d, i) { return width/2 - parseFloat(mapX2(d['enrolSecondary']))/2 + 20;})
                                    .transition()
                                    .duration(1500)
                                    .attr('cy', height - 40)
                                    .attr('cx', function(d, i) { return width/2 - parseFloat(mapX3(d['enrolTertiary']))/2 + 20;})
                                    .remove(); 
                                    
                                    
                // Over the past decade, the primary school enrolment rate has significantly improved in sub-Saharan Africa, now averaging over 80%.
                // However, the poor secondary and tertiary enrolment rates are considerably restricting the region from moving it's eceonomy toward higher-productivity sectors. 
                  
              });
              
              setTimeout(function() { firstVisual(); }, 3500);
              
              
                 
             }
             
            function changeVisual(data){ 
                
                d3.selectAll(".funnelGroup").remove();
            
                var funnelGroup = canvas.selectAll('.funnelGroup')
                                    .data(data)
                                    .enter()
                                    .append('g'); 
            
            var a = function(d, i) { return width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20;};
            console.log(" a = " + a);
            var b = function(d, i) { return (width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20 - width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20);};
            console.log(" b = " + b);
            var c =  a - b;
            console.log(" c = " + c);
            
                var primary1 = funnelGroup
                                .append("circle")
                                .attr("class", "funnelGroup")
                                .attr('cx', function(d, i) { return width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20;})
                                .attr('cy', 20)
                                .attr('r', 6)
                                .attr('fill', 'yellow')
                                .attr('fill-opacity', 0.3);
                var primary2 = funnelGroup
                                .append("circle")
                                .attr("class", "funnelGroup")
                                .attr('cx', function(d, i) { return width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20;})
                                .attr('cy', 20)
                                .attr('r', 6)
                                .attr('fill', 'yellow')
                                .attr('fill-opacity', 0.3);
                                
                var check = funnelGroup
                                    .append("rect")
                                    .attr("class", "funnelGroup")
                                    .attr('x', function(d, i) { return width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20;})
                                    .attr('y', 18.75)
                                    .attr('width', function(d, i) { return (width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20 - (width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20));})
                                    .attr('height', 2.5)
                                    .style("fill", "yellow")
                                    .attr('fill-opacity', 0)
                                    ;
        
            
                var secondary1 = funnelGroup
                                .append("circle")
                                .attr("class", "funnelGroup")
                                .attr('cx', function(d, i) { if(d['enrolSecondary'] !== ""){return width/2 + parseFloat(mapX2(d['enrolSecondary']))/2 - 20;}})
                                .attr('cy', function(d, i) { if(d['enrolSecondary'] !== ""){return height/2;}else{return 10000;}})
                                .attr('r', 6)
                                .attr('fill', 'yellow')
                                .attr('fill-opacity', 0.3); 
                var secondary2 = funnelGroup
                                .append("circle")
                                .attr("class", "funnelGroup")
                                .attr('cx', function(d, i) { if(d['enrolSecondary'] !== ""){return width/2 - parseFloat(mapX2(d['enrolSecondary']))/2 + 20;}})
                                .attr('cy', function(d, i) { if(d['enrolSecondary'] !== ""){return height/2;}else{return 10000;}})
                                .attr('r', 6)
                                .attr('fill', 'yellow')
                                .attr('fill-opacity', 0.3);                 
            
                var primSec1 = funnelGroup
                                .append("line")
                                .attr("class", "funnelGroup")
                                .attr("x1", function(d, i) { if(d['enrolSecondary'] !== ""){return width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20; }})
                                .attr("y1", function(d, i) { if(d['enrolSecondary'] !== ""){return 20;}else{return 10000;}})
                                .attr("x2", function(d, i) { if(d['enrolSecondary'] !== ""){return width/2 + parseFloat(mapX2(d['enrolSecondary']))/2 - 20;}})
                                .attr("y2", function(d, i) { if(d['enrolSecondary'] !== ""){return height/2;}else{return 10000;}})
                                .attr("stroke-width", 0.3)
                                .attr("stroke-opacity", 0.6)
                                .attr("stroke", "yellow")
                                ;
                                
                var primSec2 = funnelGroup
                                .append("line")
                                .attr("class", "funnelGroup")
                                .attr("x1", function(d, i) { if(d['enrolSecondary'] !== ""){return width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20; }})
                                .attr("y1", function(d, i) { if(d['enrolSecondary'] !== ""){return 20;}else{return 10000;}})
                                .attr("x2", function(d, i) { if(d['enrolSecondary'] !== ""){return width/2 - parseFloat(mapX2(d['enrolSecondary']))/2 + 20;}})
                                .attr("y2", function(d, i) { if(d['enrolSecondary'] !== ""){return height/2;}else{return 10000;}} )
                                .attr("stroke-width", 0.3)
                                .attr("stroke-opacity", 0.6)
                                .attr("stroke", "yellow")
                                ;
                                
                var tertiary1 = funnelGroup
                                .append("circle")
                                .attr("class", "funnelGroup")
                                .attr('cx', function(d, i) { if(d['enrolTertiary'] !== ""){return width/2 + parseFloat(mapX3(d['enrolTertiary']))/2 - 20;}})
                                .attr('cy', function(d, i) { if(d['enrolTertiary'] !== ""){return height - 40;}else{return 10000;}})
                                .attr('r', 6)
                                .attr('fill', 'yellow')
                                .attr('fill-opacity', 0.3);
                var tertiary2 = funnelGroup
                                .append("circle")
                                .attr("class", "funnelGroup")
                                .attr('cx', function(d, i) { if(d['enrolTertiary'] !== ""){return width/2 - parseFloat(mapX3(d['enrolTertiary']))/2 + 20;}})
                                .attr('cy', function(d, i) { if(d['enrolTertiary'] !== ""){return height - 40;}else{return 10000;}})
                                .attr('r', 6)
                                .attr('fill', 'yellow')
                                .attr('fill-opacity', 0.3);                
                                
                                
                var secTer1 = funnelGroup
                                .append("line")
                                .attr("class", "funnelGroup")
                                .attr("x1", function(d, i) { if(d['enrolTertiary'] !== ""){return width/2 + parseFloat(mapX2(d['enrolSecondary']))/2 - 20; }})
                                .attr("y1", function(d, i) { if(d['enrolTertiary'] !== ""){return height/2;}else{return 10000;}})
                                .attr("x2", function(d, i) {  if(d['enrolTertiary'] !== ""){return width/2 + parseFloat(mapX3(d['enrolTertiary']))/2 - 20;}} )
                                .attr("y2", function(d, i) { if(d['enrolTertiary'] !== ""){return height - 40;}else{return 10000;}})
                                .attr("stroke-width", 0.3)
                                .attr("stroke-opacity", 0.6)
                                .attr("stroke", "yellow")
                                ;
                                
                var secTer2 = funnelGroup
                                .append("line")
                                .attr("class", "funnelGroup")
                                .attr("x1", function(d, i) { if(d['enrolTertiary'] !== ""){return width/2 - parseFloat(mapX2(d['enrolSecondary']))/2 + 20; }})
                                .attr("y1", function(d, i) { if(d['enrolTertiary'] !== ""){return height/2;}else{return 10000;}})
                                .attr("x2", function(d, i) { if(d['enrolTertiary'] !== ""){return width/2 - parseFloat(mapX3(d['enrolTertiary']))/2 + 20;} })
                                .attr("y2", function(d, i) { if(d['enrolTertiary'] !== ""){return height - 40;}else{return 10000;}})
                                .attr("stroke-width", 0.3)
                                .attr("stroke-opacity", 0.6)
                                .attr("stroke", "yellow")
                                ;
                                
                var tooltip =  funnelGroup 
                                .on("mouseover", function(d) 
                                    {
                                    d3.select(this).selectAll("circle").style("stroke", 'rgb(180, 180, 180)').style("stroke-width", "2.5").style("fill-opacity", "1"); // d3.select(this).selectAll("#funnelLine").style("stroke-width", "2");
                                    d3.select(this).selectAll("line").style("stroke-width", "2.5").style("stroke-opacity", "1"); 
                                    d3.select(this).selectAll("rect").style("fill-opacity", "1"); 
                                    div.transition()		
                                        .duration(200)		
                                        .style("opacity", .9);
                                    
                                    var primColor, secColor, terColor;
                                    if(d['enrolPrimary'] >= 91.97){primColor = 'green';}else{ primColor = 'red'};
                                    if(d['enrolSecondary'] >= d['enrolSecondaryAvg']){secColor = 'green';}else{ secColor = 'red'};
                                    if(d['enrolTertiary'] >= 8.39){terColor = 'green';}else{ terColor = 'red'};
                                        
                                    div.html("<span style='font-size: 15px; text-align: left; text-transform: uppercase'>" + "<b>" + d['country'] + "</b> </span> <br>" 
                                                         // + "</span>" + "<br>" + "<span> <br> Primary:   </span>"+  "<b>"+ "<span style = 'color: " + primColor + "'>"  + d['enrolPrimary'] + "%" +  " </span> </b>"
                                                          + "<br>" + " Primary:  <b>" + "<span style='color: " + primColor + "'>" + d['enrolPrimary'] + "%" + "</span> </b>"
                                                          + "<br>" + " Secondary:  <b>" + "<span style='color: " + secColor + "'>" + d['enrolSecondary'] + "%" + "</span> </b>"
                                                          + "<br>" + " Tertiary: <b>" + "<span style='color: " + terColor + "'>" + d['enrolTertiary'] + "%" + "</span> </b>")	
                                        .style("left", (d3.event.pageX + 60) + "px")		
                                        .style("top", (d3.event.pageY - 100) + "px");
                                    })
                                .on("mouseout", function() {
                                    d3.select(this).selectAll("circle").style("stroke", 'white').style("stroke-width", "0").style("fill-opacity", "0.3");
                                    //d3.select(this).selectAll("#funnelLine").style("stroke-width", "0.3").style("stroke-opacity", "0").style("stroke", "yellow");
                                    d3.select(this).selectAll("line").style("stroke-width", "0.3").style("stroke-opacity", "0.5").style("stroke", "yellow");
                                    d3.select(this).selectAll("rect").style("fill-opacity", "0");
                                    
                                    
                                    div.transition()		
                                        .duration(500)		
                                        .style("opacity", 0);	
                                });
                                    
                
            }
        </script>
    </body>
</html>


<!---->