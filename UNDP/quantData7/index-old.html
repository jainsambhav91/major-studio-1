<!DOCTYPE html>
<html>
    <head>
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <!--<script src="d3CheckBox.js"></script>-->
        </head>
        <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Roboto:100,300" rel="stylesheet">
        <style type="text/css">
            
            
            #regions {
                background-color: black;
                border: 1px solid #26bde2;
                color: #26bde2;
                padding: 5px 20px 5px 20px;
                text-align: center;
                text-decoration: none;
                display: block;
                font-size: 10px;
                /*margin: 0px 0px 0px 50px;*/
                /*position: absolute;*/
                cursor: pointer;   
            }
            
            body {
                background-color: #202020;
            }
            
            #filter{
                float: right;
                margin-right: 50;
                padding-right: 10%;
            }
            
           div.tooltip {	
                position: absolute;
                text-align: left;			
                width: 120px;					
                height: 80px;					
                padding: 10px;				
                font: 12px sans-serif;		
                background: white;	
                border-width: 2px;		
                border-radius: 2px;
                box-shadow: 0px 0px 10px #888888;
                border-style: solid;
                border-color: white transparent transparent transparent;
                }
            
            
            #canvas {	
                
                margin-top: 40px;
                }    
            
            .button {
                background-color: black; /* Green */
                border: 1px solid #26bde2;
                color: #26bde2;
                padding: 5px 20px 5px 20px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 10px;
                /*position: absolute;*/
                cursor: pointer;
                }    
            
            .button:hover {
                    background-color: #26bde2;
                    color: black;
                }
            
            #begin{
                margin: 0px 0px 0px 50px;    
            }
            
            #option{
                margin-left: -30px;
                text-align: center;
                background-color: black;
                padding: 0 0 50px 0;
            }    
            
            .row div{
			border: 1px solid; 
		        }
            
            #myModal{
    			display: none;
    			position: fixed;
    			top: 100px;
    			left: 5%;
    			/*padding: 20px;*/
    			/*box-shadow: 0 0 5px;*/
    			background-color: white;
    			opacity: 0.95;
    	       	}
    		
    		.btn{
    			/*border: 1px solid;*/
    			cursor: pointer;
    			float: right;
    			padding: 5px 5px 0px 0px;
    		    }    
                
            .desc {
                font-family: 'Roboto', sans-serif;
                font-weight: 300;
                font-size: 12px;
                color: LightGrey;
                margin-left: 50px;
                }
            
            #country {
                font-family: 'Roboto', sans-serif;
                font-weight: 300;
                font-size: 18px;
                color: black;
                text-align: center;
                margin:0;
                padding: 15px 0px 10px 0px;
                /*margin-left: 50px;*/
                }    
            
            .graphTitle {
                font-family: 'Roboto', sans-serif;
                font-weight: bolder;
                font-size: 12px;
                color: black;
                text-align: center;
            }
            
            .nodata{
                font-family: 'Roboto', sans-serif;
                /*font-weight: 300;*/
                font-size: 18px;
                /*color: green;*/
                text-align: center;    
            }
            
            .label {
                font-family: 'Roboto', sans-serif;
                font-weight: 600;
                font-size: 10px;
                color: gray;
            }
            
            .label2 {
                font-family: 'Roboto', sans-serif;
                font-weight: 300;
                font-size: 8px;
                color: gray;
            }
            
            #expand{
                opacity: 0.7;
            }
           
            
            h1 {
                font-family: 'Roboto', sans-serif;
                font-weight:300;
                color: #26bde2;
                margin-left: 50px;
                }
            
            h4 {
                font-family: 'Roboto', sans-serif;
                font-weight:300;
                color: #26bde2;
                margin-left: 50px;
                }    
                
            .img {
              
              width:450px;
              height:auto;
              float: right;
              padding: 40px 10% 0px 20px;
              opacity: 0.8;
            } 
            
            #bottomLine { 
                display: block;
                margin-top: 0.5em;
                margin-bottom: 0.5em;
                margin-left: auto;
                margin-right: auto;
                border-style: inset;
                border-width: 1px;
                opacity: 0.5;
            }
            
            #topLine{
                opacity: 0;
            }
            
            #svgdiv{
                background-color: black;
            }
            #topdiv{
                background-color: black;
                padding: 50px 0 0 0;
            }
        </style>
        <body>
            
        <h1>The African Education Enrolment Funnel</h1>    
        <div>
            <div id = "about">
                <p class="desc">Over the past decade, the primary school enrolment rate in <br>in sub-Saharan Africa  has significantly improved , now averaging over 80%.</p>
                <p class="desc">However, the poor secondary and tertiary enrolment rates are considerably restricting <br>the region from moving it's economy toward higher-productivity sectors.</p>
                <p class="desc">This visualization is an attempt to establish this gap in the different levels of education. <br>The enrolment rates displayed below are averaged over the ten year peiod, from 2004 to 2014.</p>
                <p class="desc">The visualization further explores the change in enrolment rates over time, and compares it <br> with the change in the GINI coefficient over the same time period.</p>

                <hr id="topLine">
            </div>
             <img source="key.png">
             <!--<div id = "key">-->
             <!--    <p>.. </p>-->
             <!--    <p>.. </p>-->
             <!--    <p>.. </p>-->
             <!--</div>    -->
          
        </div>
        <div id="topdiv">
            <div id="filter"></div>    
            <div>
                <input class="button"
                       id="begin"
                       name="start" 
                       type="button" 
                       value="Begin" 
                       onclick="begin()" />
            </div> 
        </div>
        <div id='myModal'>
            <div>
                <img src="cross.png" class='btn close' style="width:15px;height:15px;">
                <p id="country"></p>
            </div>
            
          	<svg id="graph1"></svg>
          	<svg id="graph2"></svg>          	
          	<svg id="graph3"></svg>
          	<svg id="graph4"></svg>
          	<!--<svg id="graph5"></svg>-->
        </div>
        
        <div id="svgdiv">
        <svg id = "canvas"></svg>    
        </div>
       
        
        <div id="option" style="height: 20px">
            <input class="button"
                   id="expand"
                   name="updateButton" 
                   type="button" 
                   value="expand tertiary scale" 
                   onclick="expand()" />
        </div>
        
        <div id = "dataSource">
                <br><br>
                <img class="img" src="key.png">
                <h4 id="dataSource">Data Sources & Methodology:</h4>
                <p class="desc">Over the past decade, the primary school enrolment rate in <br>in sub-Saharan Africa  has significantly improved , now averaging over 80%.</p>
                <p class="desc">However, the poor secondary and tertiary enrolment rates are considerably restricting <br>the region from moving it's economy toward higher-productivity sectors.</p>
                <p class="desc">This visualization is an attempt to establish this gap in the different levels of education. <br>The enrolment rates displayed below are averaged over the ten year peiod, from 2004 to 2014.</p>
                <p class="desc">The visualization further explores the change in enrolment rates over time, and compares it <br> with the change in the GINI coefficient over the same time period.</p>
        </div>
        
        <script>
        
            // setting margin
            var margin = {top: 30, right: 0, bottom: 60, left: 50},
            width = window.innerWidth - margin.left - margin.right,
            height = window.innerHeight - 100 - margin.bottom;
            
            var regions = ["All countries", "Eastern Africa", "Western Africa", "Middle Africa", "Southern Africa", "Northern Africa"];

            var sel2 = d3.select("#filter")
                        .append("select")
                        .attr('id', 'regions')
                        .selectAll("option")
                        .data(regions)
                        .enter()
                        .append("option")
                        .text(function(d) {return d;});    
            
            var canvas = d3.select("#canvas")
                            .attr("width", width)
                            .attr("height", height);
            
            createAxes();
            
            var filtData = [];
            function firstVisual(){
                d3.csv("quantData2.csv", function(error, data) {
                if (error) throw error;
                console.log(data);

                    var funnelGroup2 = canvas.selectAll('.funnelGroup2')
                                        .data(data)
                                        .enter()
                                        .append('g'); 
                
                  
                    var primary1 = funnelGroup2
                                    .append("circle")
                                    .attr("class", "funnelGroup2")
                                    .attr('cx', function(d, i) { return width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20;})
                                    .attr('cy', 20)
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3);
                                    
                    var primary2 = funnelGroup2
                                    .append("circle")
                                    .attr("class", "funnelGroup2")
                                    .attr('cx', function(d, i) { return width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20;})
                                    .attr('cy', 20)
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3);    
                                    
                    var check = funnelGroup2
                                    .append("rect")
                                    .attr("class", "funnelGroup2")
                                    .attr('x', function(d, i) { return width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20;})
                                    .attr('y', 19)
                                    .attr('width', function(d, i) { return (width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20 - (width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20));})
                                    .attr('height', 2)
                                    .style("fill", "white")
                                    .attr('fill-opacity', 0);                
                  
                    var secondary1 = funnelGroup2
                                    .append("circle")
                                    .attr("class", "funnelGroup2")
                                    .attr('cx', function(d, i) { return width/2 + parseFloat(mapX2(d['enrolSecondary']))/2 - 20;})
                                    .attr('cy', function(d, i) { if(d['enrolSecondary'] !== ""){return height/2;}else{return 10000;}})
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3); 
                    var secondary2 = funnelGroup2
                                    .append("circle")
                                    .attr("class", "funnelGroup2")
                                    .attr('cx', function(d, i) { return width/2 - parseFloat(mapX2(d['enrolSecondary']))/2 + 20;})
                                    .attr('cy', function(d, i) { if(d['enrolSecondary'] !== ""){return height/2;}else{return 10000;}})
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3);
                                    
                    var primSec1 = funnelGroup2
                                    .append("line")
                                    .attr("class", "funnelGroup2")
                                    .attr("x1", function(d, i) { return width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20 ;})
                                    .attr("y1", function(d, i) { if(d['enrolSecondary'] !== ""){return 20;}else{return 10000;}})
                                    .attr("x2", function(d, i) { return width/2 + parseFloat(mapX2(d['enrolSecondary']))/2 - 20 ;})
                                    .attr("y2", function(d, i) { if(d['enrolSecondary'] !== ""){return height/2;}else{return 10000;}})
                                    .attr("stroke-width", 2)
                                    .attr("stroke-opacity", 0.2)
                                    .attr("stroke", "Grey");
                                    
                    var primSec2 = funnelGroup2
                                    .append("line")
                                    .attr("class", "funnelGroup2")
                                    .attr("x1", function(d, i) {return width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20; })
                                    .attr("y1", function(d, i) { if(d['enrolSecondary'] !== ""){return 20;}else{return 10000;}})
                                    .attr("x2", function(d, i) {return width/2 - parseFloat(mapX2(d['enrolSecondary']))/2  + 20;})
                                    .attr("y2", function(d, i) { if(d['enrolSecondary'] !== ""){return height/2;}else{return 10000;}})
                                    .attr("stroke-width", 2)
                                    .attr("stroke-opacity", 0.2)
                                    .attr("stroke", "Grey");

                    var tertiary1 = funnelGroup2
                                    .append("circle")
                                    .attr("class", "funnelGroup2")
                                    .attr('cx', function(d, i) { if(d['enrolTertiary'] !== ""){return width/2 + parseFloat(mapX3(d['enrolTertiary']))/2 - 20;}})
                                    .attr('cy', function(d, i) { if(d['enrolTertiary'] !== ""){return height - 40;}else{return 10000;}})
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3);
                    var tertiary2 = funnelGroup2
                                    .append("circle")
                                    .attr("class", "funnelGroup2")
                                    .attr('cx', function(d, i) { if(d['enrolTertiary'] !== ""){return width/2 - parseFloat(mapX3(d['enrolTertiary']))/2 + 20;}})
                                    .attr('cy', function(d, i) { if(d['enrolTertiary'] !== ""){return height - 40;}else{return 10000;}})
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3);                
                                  
                    var secTer1 = funnelGroup2
                                    .append("line")
                                    .attr("class", "funnelGroup2")
                                    .attr("x1", function(d, i) { if(d['enrolTertiary'] !== ""){return width/2 + parseFloat(mapX2(d['enrolSecondary']))/2 - 20; }})
                                    .attr("y1", function(d, i) { if(d['enrolTertiary'] !== ""){return height/2;}else{return 10000;}})
                                    .attr("x2", function(d, i) {if(d['enrolTertiary'] !== ""){return width/2 + parseFloat(mapX3(d['enrolTertiary']))/2 - 20;} })
                                    .attr("y2", function(d, i) { if(d['enrolTertiary'] !== ""){return height - 40;}else{return 10000;}})
                                    .attr("stroke-width", 2)
                                    .attr("stroke-opacity", 0.2)
                                    .attr("stroke", "Grey");
                                    
                                    
                    var secTer2 = funnelGroup2
                                    .append("line")
                                    .attr("class", "funnelGroup2")
                                    .attr("x1", function(d, i) { if(d['enrolTertiary'] !== ""){ return width/2 - parseFloat(mapX2(d['enrolSecondary']))/2 + 20; }})
                                    .attr("y1", function(d, i) { if(d['enrolTertiary'] !== ""){return height/2;}else{return 10000;}})
                                    .attr("x2", function(d, i) { if(d['enrolTertiary'] !== ""){ return width/2 - parseFloat(mapX3(d['enrolTertiary']))/2 + 20;} })
                                    .attr("y2", function(d, i) { if(d['enrolTertiary'] !== ""){return height - 40;}else{return 10000;}})
                                    .attr("stroke-width", 2)
                                    .attr("stroke-opacity", 0.2)
                                    .attr("stroke", "Grey");
                    
                    var tooltip =  funnelGroup2 
                                    .on("click", function(d) { 
                                        
                                $("#graph1").empty();
                                $("#graph2").empty();
                                $("#graph3").empty();
                                $("#graph4").empty();
                                // $("#graph5").empty();
  
                                var ttwidth = width - 100;
                                var graphWidth = ttwidth/4;
                                                    
                                d3.select("#country")
                                        .attr("x", (ttwidth)/2)
                                        .attr("y", 5)
                                        .text(d['country'] + ": change over time");
                                        
                                var mapygraph1 = d3.scaleLinear().domain([0, 100]).range([7*(graphWidth/8), graphWidth/8]);
                                var mapygraph2 = d3.scaleLinear().domain([0, 100]).range([7*(graphWidth/8), graphWidth/8]);   
                                var mapygrpah3 = d3.scaleLinear().domain([0, 100]).range([7*(graphWidth/8), graphWidth/8]); 
                                var mapygraph4 = d3.scaleLinear().domain([25, 75]).range([7*(graphWidth/8), graphWidth/8]);
                                
                                for(var i = 1; i<=4; i++)
                                {
                                    var id = "#graph" + i;
                                    
                                d3.select(id)
                                        .attr("width", graphWidth)
                                        .attr("height", graphWidth);
                                
                                d3.select(id)
                                        .append("line")
                                        .attr("x1", graphWidth/8)
                                        .attr("y1", graphWidth/8)
                                        .attr("x2", (graphWidth/8)*7)
                                        .attr("y2", graphWidth/8)
                                        .attr('stroke', '#eaeaea')
                                        .attr('stroke-width', 2);
                                d3.select(id)
                                        .append("line")
                                        .attr("x1", graphWidth/8 )
                                        .attr("y1", graphWidth/8 + 2*(graphWidth/8))
                                        .attr("x2", (graphWidth/8)*7)
                                        .attr("y2", graphWidth/8 + 2*(graphWidth/8))
                                        .attr('stroke', '#eaeaea')
                                        .attr('stroke-width', 2);
                                d3.select(id)
                                        .append("line")
                                        .attr("x1", graphWidth/8)
                                        .attr("y1", graphWidth/8 + 4*(graphWidth/8))
                                        .attr("x2", (graphWidth/8)*7)
                                        .attr("y2", graphWidth/8 + 4*(graphWidth/8))
                                        .attr('stroke', '#eaeaea')
                                        .attr('stroke-width', 2);
                                d3.select(id)
                                        .append("line")
                                        .attr("x1", graphWidth/8)
                                        .attr("y1", graphWidth/8 + 6*(graphWidth/8))
                                        .attr("x2", (graphWidth/8)*7)
                                        .attr("y2", graphWidth/8 + 6*(graphWidth/8))
                                        .attr('stroke', '#eaeaea')
                                        .attr('stroke-width', 2);    
                                       
                                d3.select(id)
                                        .append("line")
                                        .attr("x1", graphWidth/8)
                                        .attr("y1", graphWidth/8)
                                        .attr("x2", graphWidth/8)
                                        .attr("y2", graphWidth/8 + 6*(graphWidth/8))
                                        .attr('stroke', '#eaeaea')
                                        .attr('stroke-width', 2);
                                d3.select(id)
                                        .append("line")
                                        .attr("x1", graphWidth/8 + 2*(graphWidth/8))
                                        .attr("y1", graphWidth/8 )
                                        .attr("x2", (graphWidth/8) + 2*(graphWidth/8))
                                        .attr("y2", graphWidth/8 + 6*(graphWidth/8))
                                        .attr('stroke', '#eaeaea')
                                        .attr('stroke-width', 2);
                                d3.select(id)
                                        .append("line")
                                        .attr("x1", graphWidth/8 + 4*(graphWidth/8))
                                        .attr("y1", graphWidth/8)
                                        .attr("x2", graphWidth/8 + 4*(graphWidth/8))
                                        .attr("y2", graphWidth/8 + 6*(graphWidth/8))
                                        .attr('stroke', '#eaeaea')
                                        .attr('stroke-width', 2);
                                d3.select(id)
                                        .append("line")
                                        .attr("x1", graphWidth/8 + 6*(graphWidth/8))
                                        .attr("y1", graphWidth/8)
                                        .attr("x2", graphWidth/8 + 6*(graphWidth/8))
                                        .attr("y2", graphWidth/8 + 6*(graphWidth/8))
                                        .attr('stroke', '#eaeaea')
                                        .attr('stroke-width', 2);  
                                
                                d3.select(id)
                                        .append("text")
                                        .attr("class", "label")
                                        .attr("x", graphWidth/8)
                                        .attr("y", 7*(graphWidth/8) + 15)
                                        .text("'90-'95")
                                        .attr("text-anchor", "middle");
                                d3.select(id)
                                        .append("text")
                                        .attr("class", "label")
                                        .attr("x", 7*(graphWidth/8))
                                        .attr("y", 7*(graphWidth/8) + 15)
                                        .text("'06-'10")
                                        .attr("text-anchor", "middle");      
                                }
                                
                                    
                                d3.select("#graph1")
                                        .append("text")
                                        .attr("class", "graphTitle")
                                        .attr("x", graphWidth/2)
                                        .attr("y", 20)
                                        .text("primary enrollment rate")
                                        .attr("text-anchor", "middle");
                                
                                d3.select("#graph2")
                                        .append("text")
                                        .attr("class", "graphTitle")
                                        .attr("x", graphWidth/2)
                                        .attr("y", 20)
                                        .text("secondary enrollment rate")
                                        .attr("text-anchor", "middle");
                                d3.select("#graph3")
                                        .append("text")
                                        .attr("class", "graphTitle")
                                        .attr("x", graphWidth/2)
                                        .attr("y", 20)
                                        .text("tertiary enrollment rate")
                                        .attr("text-anchor", "middle"); 
                                d3.select("#graph4")
                                        .append("text")
                                        .attr("class", "graphTitle")
                                        .attr("x", graphWidth/2)
                                        .attr("y", 20)
                                        .text("inequality (GINI)")
                                        .attr("text-anchor", "middle"); 
                                // d3.select("#graph5")
                                //         .append("text")
                                //         .attr("class", "graphTitle")
                                //         .attr("x", graphWidth/2)
                                //         .attr("y", 20)
                                //         .text("poverty")
                                //         .attr("text-anchor", "middle"); 
                        
                        if(d['pri9195'] == "" && d['pri0610'] == ""){
                            
                            d3.select("#graph1")
                                        .append("text")
                                        .attr("class", "nodata")
                                        .text("No Data")
                                        .attr('x', graphWidth/2)
                                        .attr('y', graphWidth/2 + 5)
                                        .style("fill", "LightGrey")
                                        .attr("text-anchor", "middle");    
                        }
                        
                        if(d['sec9195'] == "" && d['sec0610'] == ""){
                             d3.select("#graph2")
                                        .append("text")
                                        .attr("class", "nodata")
                                        .text("No Data")
                                        .attr('x', graphWidth/2)
                                        .attr('y', graphWidth/2 + 5)
                                        .style("fill", "LightGrey")
                                        .attr("text-anchor", "middle");   
                        }
                        
                        if(d['ter9195'] == "" && d['ter0610'] == ""){
                             d3.select("#graph3")
                                        .append("text")
                                        .attr("class", "nodata")
                                        .text("No Data")
                                        .attr('x', graphWidth/2)
                                        .attr('y', graphWidth/2 + 5)
                                        .style("fill", "LightGrey")
                                        .attr("text-anchor", "middle");   
                        }
                        
                        if(d['gini9195'] == "" && d['gini0610'] == ""){
                             d3.select("#graph4")
                                        .append("text")
                                        .attr("class", "nodata")
                                        .text("No Data")
                                        .attr('x', graphWidth/2)
                                        .attr('y', graphWidth/2 + 5)
                                        .style("fill", "LightGrey")
                                        .attr("text-anchor", "middle");   
                        }
                        
                        if(d['pri9195'] !== "" && d['pri0610'] !== ""){  
                       
                        var line1 = d3.select("#graph1")
                                    .append("line")
                                    .attr("x1", graphWidth/8)
                                    .attr("y1", mapygraph1(d['pri9195']))
                                    .attr("x2", 7*(graphWidth/8))
                                    .attr("y2", mapygraph1(d['pri0610']))
                                    .attr('stroke', '#27bde2')
                                    .attr('stroke-width', 2);
                        }
                        
                        if(d['pri9195'] !== ""){
                        var circle1a = d3.select("#graph1")
                                        .append("circle")
                                        .attr("cx", graphWidth/8)
                                        .attr('cy', mapygraph1(d['pri9195']))
                                        .attr('r', 5)
                                        .attr('fill', '#27bde2')
                                        .attr('stroke', 'white')
                                        .attr('stroke-width', 2);
                        
                        var text1a = d3.select("#graph1")
                                        .append("text")
                                        .attr('class', 'label2')
                                        .text(d['pri9195'] + "%")
                                        .attr('x', graphWidth/8 - 15)
                                        .attr('y', mapygraph1(d['pri9195']) - 15);
                                        
                        }
                        
                        if(d['pri0610'] !== ""){
                        var circle1b = d3.select("#graph1")
                                        .append("circle")
                                        .attr("cx", 7*(graphWidth/8))
                                        .attr('cy', mapygraph1(d['pri0610']))
                                        .attr('r', 5)
                                        .attr('fill', '#27bde2')
                                        .attr('stroke', 'white')
                                        .attr('stroke-width', 2);
                                        
                        var text1b = d3.select("#graph1")
                                        .append("text")
                                        .attr('class', 'label2')
                                        .text(d['pri0610'] + "%")
                                        .attr('x', 7*(graphWidth/8) - 15)
                                        .attr('y', mapygraph1(d['pri0610']) - 15);
                                        
                        }            
                        
                        if(d['sec9195'] !== "" && d['sec0610'] !== ""){
                        var line2 = d3.select("#graph2")
                                    .append("line")
                                    .attr("x1", graphWidth/8)
                                    .attr("y1", mapygraph1(d['sec9195']))
                                    .attr("x2", 7*(graphWidth/8))
                                    .attr("y2", mapygraph1(d['sec0610']))
                                    .attr('stroke', '#27bde2')
                                    .attr('stroke-width', 2);            
                        }
                        
                        if(d['sec9195'] !== ""){
                        var circle2a = d3.select("#graph2")
                                        .append("circle")
                                        .attr("cx", graphWidth/8)
                                        .attr('cy', mapygraph1(d['sec9195']))
                                        .attr('r', 5)
                                        .attr('fill', '#27bde2')
                                        .attr('stroke', 'white')
                                        .attr('stroke-width', 2);
                        
                        var text2a = d3.select("#graph2")
                                        .append("text")
                                        .attr('class', 'label2')
                                        .text(d['sec9195'] + "%")
                                        .attr('x', (graphWidth/8) - 15)
                                        .attr('y', mapygraph1(d['sec9195']) - 15);                
                                        
                        }
                        
                        if(d['sec0610'] !== ""){
                        var circle2b = d3.select("#graph2")
                                        .append("circle")
                                        .attr("cx", 7*(graphWidth/8))
                                        .attr('cy', mapygraph1(d['sec0610']))
                                        .attr('r', 5)
                                        .attr('fill', '#27bde2')
                                        .attr('stroke', 'white')
                                        .attr('stroke-width', 2);
                        
                        var text2b = d3.select("#graph2")
                                        .append("text")
                                        .attr('class', 'label2')
                                        .text(d['sec0610'] + "%")
                                        .attr('x', 7*(graphWidth/8) - 15)
                                        .attr('y', mapygraph2(d['sec0610']) - 15);                   
                        }
                        
                        if(d['ter9195'] !== "" && d['ter0610'] !== ""){
                        var line3 = d3.select("#graph3")
                                    .append("line")
                                    .attr("x1", graphWidth/8)
                                    .attr("y1", mapygraph1(d['ter9195']))
                                    .attr("x2", 7*(graphWidth/8))
                                    .attr("y2", mapygraph1(d['ter0610']))
                                    .attr('stroke', '#27bde2')
                                    .attr('stroke-width', 2);
                        }
                        
                        if(d['ter9195'] !== ""){
                        var circle3a = d3.select("#graph3")
                                        .append("circle")
                                        .attr("cx", graphWidth/8)
                                        .attr('cy', mapygraph1(d['ter9195']))
                                        .attr('r', 5)
                                        .attr('fill', '#27bde2')
                                        .attr('stroke', 'white')
                                        .attr('stroke-width', 2);
                        
                        var text3a = d3.select("#graph3")
                                        .append("text")
                                        .attr('class', 'label2')
                                        .text(d['ter9195'] + "%")
                                        .attr('x', (graphWidth/8) - 15)
                                        .attr('y', mapygraph1(d['ter9195']) - 15);                     
                        
                                        
                        }
                        if(d['ter0610'] != ""){
                        var circle3b = d3.select("#graph3")
                                        .append("circle")
                                        .attr("cx", 7*(graphWidth/8))
                                        .attr('cy', mapygraph1(d['ter0610']))
                                        .attr('r', 5)
                                        .attr('fill', '#27bde2')
                                        .attr('stroke', 'white')
                                        .attr('stroke-width', 2);
                         
                        var text3b = d3.select("#graph3")
                                        .append("text")
                                        .attr('class', 'label2')
                                        .text(d['ter0610'] + "%")
                                        .attr('x', 7*(graphWidth/8) - 15)
                                        .attr('y', mapygraph1(d['ter0610']) - 15);                     
                        
                                        
                        }                
                                    
                        if(d['gini9195'] !== "" && d['gini0610'] !== ""){
                        var line3 = d3.select("#graph4")
                                    .append("line")
                                    .attr("x1", graphWidth/8)
                                    .attr("y1", mapygraph4(d['gini9195']))
                                    .attr("x2", 7*(graphWidth/8))
                                    .attr("y2", mapygraph4(d['gini0610']))
                                    .attr('stroke', '#fcc30b')
                                    .attr('stroke-width', 2);
                        }
                        
                        if(d['gini9195'] !== ""){
                        var circle4a = d3.select("#graph4")
                                        .append("circle")
                                        .attr("cx", graphWidth/8)
                                        .attr('cy', mapygraph4(d['gini9195']))
                                        .attr('r', 5)
                                        .attr('fill', '#fcc30b')
                                        .attr('stroke', 'white')
                                        .attr('stroke-width', 2);
                        
                        var text4a = d3.select("#graph4")
                                        .append("text")
                                        .attr('class', 'label2')
                                        .text(d['gini9195'] + "%")
                                        .attr('x', (graphWidth/8) - 15)
                                        .attr('y', mapygraph4(d['gini9195']) - 15);                   
                                        
                        }
                          
                        if(d['gini0610'] !== ""){                
                        var circle4b = d3.select("#graph4")
                                        .append("circle")
                                        .attr("cx", 7*(graphWidth/8))
                                        .attr('cy', mapygraph4(d['gini0610']))
                                        .attr('r', 5)
                                        .attr('fill', '#fcc30b')
                                        .attr('stroke', 'white')
                                        .attr('stroke-width', 2); 
                        var text4b = d3.select("#graph4")
                                        .append("text")
                                        .attr('class', 'label2')
                                        .text(d['gini0610'] + "%")
                                        .attr('x', 7*(graphWidth/8) - 15)
                                        .attr('y', mapygraph4(d['gini0610']) - 15);
                                        
                                        
                        }        
                                $(".btn.close").on("click",function(){
			                    	$("#myModal").fadeOut();
			                            })
                                        
                                $("#myModal").fadeIn(); })
                                    
                                    .on("mouseover", function(d) 
                                        {
                                        d3.select(this).selectAll("circle").style("stroke", 'rgb(180, 180, 180)').style("stroke-width", "2.5").style("fill-opacity", "1"); d3.select(this).selectAll("line").style("stroke", "white").style("stroke-width", "2").style("stroke-opacity", "1");
                                        d3.select(this).selectAll("rect").style("fill-opacity", "1");
                                        div.transition()		
                                            .duration(200)		
                                            .style("opacity", .9);
                                            
                                        var primColor, secColor, terColor;
                                    if(d['enrolPrimary'] >= 91.97){primColor = 'green';}else{ primColor = 'red'};
                                    if(d['enrolSecondary'] >= d['enrolSecondaryAvg']){secColor = 'green';}else{ secColor = 'red'};
                                    if(d['enrolTertiary'] >= 8.39){terColor = 'green';}else{ terColor = 'red'};
                                        
                                    div.html("<span style='font-size: 15px; text-align: left; text-transform: uppercase'>" + "<b>" + d['country'] + "</b> </span> <br>" 
                                                         // + "</span>" + "<br>" + "<span> <br> Primary:   </span>"+  "<b>"+ "<span style = 'color: " + primColor + "'>"  + d['enrolPrimary'] + "%" +  " </span> </b>"
                                                          + "<br>" + " Primary:  <b>" + "<span style='color: " + primColor + "'>" + d['enrolPrimary'] + "%" + "</span> </b>"
                                                          + "<br>" + " Secondary:  <b>" + "<span style='color: " + secColor + "'>" + d['enrolSecondary'] + "%" + "</span> </b>"
                                                          + "<br>" + " Tertiary: <b>" + "<span style='color: " + terColor + "'>" + d['enrolTertiary'] + "%" + "</span> </b>")	
                                        .style("left", (d3.event.pageX - 80) + "px")		
                                        .style("top", (d3.event.pageY - 130) + "px");
                                        })
                                    .on("mouseout", function() {
                                        d3.select(this).selectAll("circle").style("stroke", 'white').style("stroke-width", "0").style("fill-opacity", "0.3");
                                        d3.select(this).selectAll("line").style("stroke-width", "0.3").style("stroke-opacity", "0.5").style("stroke", "grey");
                                        d3.select(this).selectAll("rect").style("fill-opacity", "0");
                                        div.transition()		
                                            .duration(500)		
                                            .style("opacity", 0);	
                                    });
                                    
                d3.select("#regions").on("change",function(){
                filtData = [];
                
                for(var i = 0; i<data.length; i++){
                    if(regions[this.selectedIndex] == data[i]['subRegion']){
                     filtData.push(data[i]);   
                    }
                }
                console.log(filtData);
                d3.selectAll("#funnelgrp").remove();
                changeVisual(filtData);
                });
                
            }); //function(err, data) ends 
            }
                
            var mapX1 = d3.scaleLinear().domain([0, 100]).range([50, width - 50]);
            var mapX2 = d3.scaleLinear().domain([0, 100]).range([50, width - 50]);   
            var mapX3 = d3.scaleLinear().domain([0, 100]).range([50, width - 50]);  
            
            var div = d3.select("body").append("div")	
                                    .attr("class", "tooltip")				
                                    .style("opacity", 0)
                                    .attr("x", "200");
                                    
            function createAxes(){
    
    // ------------- create axis ONE -------------------------------- 
                
                var axis1 = canvas
                                .append("line")
                                .attr("x1", 40 )
                                .attr("y1", 20)
                                .attr("x2", width - 40)
                                .attr("y2", 20)
                                .attr("stroke-width", 0.5)
                                .attr("stroke", "LightGrey");
                                
                            canvas
                                .append("line")
                                .attr("x1", 40 )
                                .attr("y1", 20 - 5)
                                .attr("x2", 40)
                                .attr("y2", 20 + 5)
                                .attr("stroke-width", 1)
                                .attr("stroke", "white");
      
                            canvas
                                .append("line")
                                .attr("x1", width - 40 )
                                .attr("y1", 20 - 5)
                                .attr("x2", width - 40)
                                .attr("y2", 20 + 5)
                                .attr("stroke-width", 1)
                                .attr("stroke", "white");
                            
                            canvas
                                .append("line")
                                .attr("x1", width/2 )
                                .attr("y1", 20 - 5)
                                .attr("x2", width/2)
                                .attr("y2", 20 + 5)
                                .attr("stroke-width", 1)
                                .attr("stroke", "white");    
                                
                            canvas
                                .append("text")
                                .attr("x", 40)
                                .attr("y", 20 + 20)
                                .text("50%")
                                .attr("text-anchor", "middle")
                                .attr("font-family", "'Roboto', sans-serif")
                                .attr("font-weight", "300")
                                .attr("font-size", "12")
                                .attr("fill", "LightGrey");
                                
                            canvas
                                .append("text")
                                .attr("x", width - 40)
                                .attr("y", 20 + 20)
                                .text("50%")
                                .attr("text-anchor", "middle")
                                .attr("font-family", "'Roboto', sans-serif")
                                .attr("font-weight", "300")
                                .attr("font-size", "12")
                                .attr("fill", "LightGrey"); 
                                
                             canvas
                                .append("text")
                                .attr("x", width/2)
                                .attr("y", 20 + 20)
                                .attr("text-anchor", "middle")
                                .text("primary enrolment")
                                .attr("font-family", "'Roboto', sans-serif")
                                .attr("font-weight", "300")
                                .attr("font-size", "12")
                                .attr("fill", "LightGrey"); 
                                
                    var imgs = canvas.selectAll("image").data([0]);
                                    imgs.enter()
                                        .append("svg:image")
                                        .attr("id", "arrow")
                                        .attr("xlink:href", "arrow.png")
                                        .attr("x", width/2 - 105)
                                        .attr("y", 80)
                                        .attr("width", "210")
                                        .attr("height", "70")
                                        .attr("opacity", 0.7);
                 
    
    // ------------- create axis TWO --------------------------------
    
                var axis2 = canvas
                                .append("line")
                                .attr("x1", 40 )
                                .attr("y1", height/2)
                                .attr("x2", width - 40)
                                .attr("y2", height/2)
                                .attr("stroke-width", 0.5)
                                .attr("stroke", "LightGrey");                            
    
                             canvas
                                .append("line")
                                .attr("x1", 40 )
                                .attr("y1", height/2 - 5)
                                .attr("x2", 40)
                                .attr("y2", height/2 + 5)
                                .attr("stroke-width", 1)
                                .attr("stroke", "white"); 
                
                            canvas
                                .append("line")
                                .attr("x1", width - 40 )
                                .attr("y1", height/2 - 5)
                                .attr("x2", width - 40)
                                .attr("y2", height/2 + 5)
                                .attr("stroke-width", 1)
                                .attr("stroke", "white"); 
                            
                            canvas
                                .append("line")
                                .attr("x1", width/2 )
                                .attr("y1", height/2 - 5)
                                .attr("x2", width/2)
                                .attr("y2", height/2 + 5)
                                .attr("stroke-width", 1)
                                .attr("stroke", "white"); 
                                
                            canvas
                                .append("text")
                                .attr("x", 40)
                                .attr("y", height/2 + 20)
                                .text("50%")
                                .attr("text-anchor", "middle")
                                .attr("font-family", "'Roboto', sans-serif")
                                .attr("font-weight", "300")
                                .attr("font-size", "12")
                                .attr("fill", "LightGrey");
                                
                            canvas
                                .append("text")
                                .attr("x", width - 40)
                                .attr("y", height/2 + 20)
                                .text("50%")
                                .attr("text-anchor", "middle")
                                .attr("font-family", "'Roboto', sans-serif")
                                .attr("font-weight", "300")
                                .attr("font-size", "12")
                                .attr("fill", "LightGrey");    
                                
                                
                            canvas
                                .append("text")
                                .attr("x", width/2)
                                .attr("y", height/2 + 20)
                                .attr("text-anchor", "middle")
                                .text("secondary enrolment")
                                .attr("font-family", "'Roboto', sans-serif")
                                .attr("font-weight", "300")
                                .attr("font-size", "12")
                                .attr("fill", "LightGrey");    
                                
                
    // ------------- create axis THREE --------------------------------            
                
                var axis3 = canvas
                                .append("line")
                                .attr("x1", 40 )
                                .attr("y1", height - 40)
                                .attr("x2", width - 40)
                                .attr("y2", height - 40)
                                .attr("stroke-width", 0.5)
                                .attr("stroke", "LightGrey");
                                
                            canvas
                                .append("text")
                                .attr("x", 40)
                                .attr("id", "label50a")
                                .attr("y", height - 40 + 20 )
                                .text("50%")
                                .attr("text-anchor", "middle")
                                .attr("font-family", "'Roboto', sans-serif")
                                .attr("font-weight", "300")
                                .attr("font-size", "12")
                                .attr("fill", "LightGrey");
                                
                            canvas
                                .append("text")
                                .attr("x", width - 40)
                                .attr("y", height - 40 + 20)
                                .attr("id", "label50b")
                                .text("50%")
                                .attr("text-anchor", "middle")
                                .attr("font-family", "'Roboto', sans-serif")
                                .attr("font-weight", "300")
                                .attr("font-size", "12")
                                .attr("fill", "LightGrey");                    
                                
                            canvas
                                .append("line")
                                .attr("x1", 40 )
                                .attr("y1", height - 40 - 5)
                                .attr("x2", 40)
                                .attr("y2", height - 40 + 5)
                                .attr("stroke-width", 1)
                                .attr("stroke", "white"); 
                
                            canvas
                                .append("line")
                                .attr("x1", width - 40 )
                                .attr("y1", height - 40 - 5 )
                                .attr("x2", width - 40)
                                .attr("y2", height - 40 + 5 )
                                .attr("stroke-width", 1)
                                .attr("stroke", "white"); 
                            
                            canvas
                                .append("line")
                                .attr("x1", width/2 )
                                .attr("y1", height - 40 - 5)
                                .attr("x2", width/2)
                                .attr("y2", height - 40 + 5)
                                .attr("stroke-width", 1)
                                .attr("stroke", "white");
                                
                            canvas
                                .append("text")
                                .attr("x", width/2)
                                .attr("y", height - 40 + 20 )
                                .text("tertiary enrolment")
                                .attr("text-anchor", "middle")
                                .attr("font-family", "'Roboto', sans-serif")
                                .attr("font-weight", "300")
                                .attr("font-size", "12")
                                .attr("fill", "LightGrey");  
                                
                            
    // ---------------
    
    }
            
            function expand(){
            d3.selectAll(".funnelGroup").remove();
            d3.selectAll(".funnelGroup2").remove();

            var mapX3old = d3.scaleLinear().domain([0, 100]).range([50, width - 50]);
            mapX3 = d3.scaleLinear().domain([0, 10]).range([50, width - 50]);
            
            var mapX2old = d3.scaleLinear().domain([0, 100]).range([50, width - 50]);
            mapX2 = d3.scaleLinear().domain([0, 100]).range([width - 100, width - 50]);
            
            var mapX1old = d3.scaleLinear().domain([0, 100]).range([50, width - 50]);
            mapX1 = d3.scaleLinear().domain([0, 100]).range([width - 100, width - 50]);
            
            // use positions from funnel group 2 and transition the funnelGroup two element to x10 times the position and then remove it
            // then add a time delay and run the firstvisual function
            // increase margins from both sides
            // add context at the top
             d3.csv("quantData2.csv", function(error, data) {
                if (error) throw error;
            var expandGroup = canvas.selectAll('.expandGroup')
                                        .data(data)
                                        .enter()
                                        .append('g');
            
                    var primary1 = expandGroup
                                    .append("circle")
                                    .attr("class", "expandGroup")
                                    .attr('cx', function(d, i) { return width/2 + parseFloat(mapX1old(d['enrolTertiary']))/2 - 20;})
                                    .attr('cy', 20)
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3)
                                    .transition()
                                    .duration(1500)
                                    .attr('cy', 20)
                                    .attr('cx', function(d, i) { return width/2 + parseFloat(mapX1(d['enrolTertiary']))/2 - 20;})
                                    .remove();
                    var primary2 = expandGroup
                                    .append("circle")
                                    .attr("class", "expandGroup")
                                    .attr('cx', function(d, i) { return width/2 - parseFloat(mapX1old(d['enrolTertiary']))/2 + 20;})
                                    .attr('cy', 20)
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3)
                                    .transition()
                                    .duration(1500)
                                    .attr('cy', 20)
                                    .attr('cx', function(d, i) { return width/2 - parseFloat(mapX1(d['enrolTertiary']))/2 + 20;})
                                    .remove();
                    
                    var sec1 = expandGroup
                                    .append("circle")
                                    .attr("class", "expandGroup")
                                    .attr('cx', function(d, i) { return width/2 + parseFloat(mapX2old(d['enrolTertiary']))/2 - 20;})
                                    .attr('cy', height/2)
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3)
                                    .transition()
                                    .duration(1500)
                                    .attr('cy', height/2)
                                    .attr('cx', function(d, i) { return width/2 + parseFloat(mapX2(d['enrolTertiary']))/2 - 20;})
                                    .remove();
                    var sec2 = expandGroup
                                    .append("circle")
                                    .attr("class", "expandGroup")
                                    .attr('cx', function(d, i) { return width/2 - parseFloat(mapX2old(d['enrolTertiary']))/2 + 20;})
                                    .attr('cy', height/2)
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3)
                                    .transition()
                                    .duration(1500)
                                    .attr('cy', height/2)
                                    .attr('cx', function(d, i) { return width/2 - parseFloat(mapX2(d['enrolTertiary']))/2 + 20;})
                                    .remove();
                    
                    
                    
                    var tertiary1 = expandGroup
                                    .append("circle")
                                    .attr("class", "expandGroup")
                                    .attr('cx', function(d, i) { return width/2 + parseFloat(mapX3old(d['enrolTertiary']))/2 - 20;})
                                    .attr('cy', height - 40)
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3)
                                    .transition()
                                    .duration(1500)
                                    .attr('cy', height - 40)
                                    .attr('cx', function(d, i) { return width/2 + parseFloat(mapX3(d['enrolTertiary']))/2 - 20;})
                                    .remove();
                    var tertiary2 = expandGroup
                                    .append("circle")
                                    .attr("class", "expandGroup")
                                    .attr('cx', function(d, i) { return width/2 - parseFloat(mapX3old(d['enrolTertiary']))/2 + 20;})
                                    .attr('cy', height - 40)
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3)
                                    .transition()
                                    .duration(1500)
                                    .attr('cy', height - 40)
                                    .attr('cx', function(d, i) { return width/2 - parseFloat(mapX3(d['enrolTertiary']))/2 + 20;})
                                    .remove();
                            
                            d3.select("#label50a")
                                    .transition()
                                    .duration(1500)
                                    .text("10%");
                            
                            d3.select("#label50b")
                                    .transition()
                                    .duration(1500)
                                    .text("10%");        
                            
                                    
             }); 
            
            setTimeout(function() { firstVisual(); }, 1500);
           
        }
             
            function begin(){
                
            d3.select("#arrow").remove();
            // d3.select(".expandGroup").remove();
            // d3.select(".funnelGroup2").remove();
              
             d3.csv("quantData2.csv", function(error, data) {
                if (error) throw error;
                
              var funnelGroup3 = canvas.selectAll('.funnelGroup3')
                                        .data(data)
                                        .enter()
                                        .append('g'); 
                    
                    var prim1 = funnelGroup3
                                    .append("circle")
                                    .attr("class", "funnelGroup3")
                                    .attr('cx', function(d, i) { return width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20;})
                                    .attr('cy', 20)
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3)
                                    .transition()
                                    .duration(3500)
                                    .remove();
                    
                    var prim2 = funnelGroup3
                                    .append("circle")
                                    .attr("class", "funnelGroup3")
                                    .attr('cx', function(d, i) { return width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20;})
                                    .attr('cy', 20)
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3)
                                    .transition()
                                    .duration(3500)
                                    .remove();
                    
                    var sec1 = funnelGroup3
                                    .append("circle")
                                    .attr("class", "funnelGroup3")
                                    .attr('cy', height/2)
                                    .attr('cx', function(d, i) { return width/2 + parseFloat(mapX2(d['enrolSecondary']))/2 - 20;})
                                    .attr('r', 0)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3)
                                    .transition()
                                    .delay(2000)
                                    .attr('r', 6)
                                    .transition()
                                    .duration(1500)
                                    .remove();
                    
                     var sec2 = funnelGroup3
                                    .append("circle")
                                    .attr("class", "funnelGroup3")
                                    .attr('cy', height/2)
                                    .attr('cx', function(d, i) { return width/2 - parseFloat(mapX2(d['enrolSecondary']))/2 + 20;})
                                    .attr('r', 0)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3)
                                    .transition()
                                    .delay(2000)
                                    .attr('r', 6)
                                    .transition()
                                    .duration(1500)
                                    .remove();                
                                    
                                        
                    
                    var primSec1 = funnelGroup3
                                     .append("line")
                                     .attr("class", "funnelGroup3")
                                     .attr("x1", function(d, i) {return width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20; })
                                     .attr("y1", function(d, i) { if(d['enrolSecondary'] !== ""){return 20;}else{return 10000;}})
                                     .attr("x2", function(d, i) {return width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20; })
                                     .attr("y2", function(d, i) { if(d['enrolSecondary'] !== ""){return 20;}else{return 10000;}})
                                     .attr("stroke-width", 0.25)
                                     .attr("stroke-opacity", 0.5)
                                     .attr("stroke", "LightGrey")
                                     .transition()
                                     .delay(500)
                                     .duration(1500)
                                     .attr("x2", function(d, i) {return width/2 - parseFloat(mapX2(d['enrolSecondary']))/2  + 20;})
                                     .attr("y2", function(d, i) { if(d['enrolSecondary'] !== ""){return height/2;}else{return 10000;}})
                                     .transition()
                                     .duration(1500)
                                     .remove();
                   
                    var primSec2 = funnelGroup3
                                     .append("line")
                                     .attr("class", "funnelGroup3")
                                     .attr("x1", function(d, i) {return width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20; })
                                     .attr("y1", function(d, i) { if(d['enrolSecondary'] !== ""){return 20;}else{return 10000;}})
                                     .attr("x2", function(d, i) {return width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20; })
                                     .attr("y2", function(d, i) { if(d['enrolSecondary'] !== ""){return 20;}else{return 10000;}})
                                     .attr("stroke-width", 0.25)
                                     .attr("stroke-opacity", 0.5)
                                     .attr("stroke", "LightGrey")
                                     .transition()
                                     .delay(500)
                                     .duration(1500)
                                     .attr("x2", function(d, i) {return width/2 + parseFloat(mapX2(d['enrolSecondary']))/2  - 20;})
                                     .attr("y2", function(d, i) { if(d['enrolSecondary'] !== ""){return height/2;}else{return 10000;}})
                                     .transition()
                                     .duration(1500)
                                     .remove();
                    
                    var secTer1 = funnelGroup3
                                     .append("line")
                                     .attr("class", "funnelGroup3")
                                     .attr("x1", function(d, i) { if(d['enrolTertiary'] !== ""){return width/2 + parseFloat(mapX2(d['enrolSecondary']))/2 - 20; }})
                                     .attr("y1", function(d, i) { if(d['enrolTertiary'] !== ""){return height/2;}else{return 10000;}})
                                     .attr("x2", function(d, i) { if(d['enrolTertiary'] !== ""){return width/2 + parseFloat(mapX2(d['enrolSecondary']))/2 - 20; }})
                                     .attr("y2", function(d, i) { if(d['enrolTertiary'] !== ""){return height/2;}else{return 10000;}})
                                     .attr("stroke-width", 0.25)
                                     .attr("stroke-opacity", 0.5)
                                     .attr("stroke", "LightGrey")
                                     .transition()
                                     .delay(2000)
                                     .duration(1500)
                                     .attr("x2", function(d, i) {if(d['enrolTertiary'] !== ""){return width/2 + parseFloat(mapX3(d['enrolTertiary']))/2 - 20;} })
                                     .attr("y2", function(d, i) { if(d['enrolTertiary'] !== ""){return height - 40;}else{return 10000;}})
                                     .remove();                 
                    
                    var secTer2 = funnelGroup3
                                     .append("line")
                                     .attr("class", "funnelGroup3")
                                     .attr("x1", function(d, i) { if(d['enrolTertiary'] !== ""){ return width/2 - parseFloat(mapX2(d['enrolSecondary']))/2 + 20; }})
                                     .attr("y1", function(d, i) { if(d['enrolTertiary'] !== ""){return height/2;}else{return 10000;}})
                                     .attr("x2", function(d, i) { if(d['enrolTertiary'] !== ""){ return width/2 - parseFloat(mapX2(d['enrolSecondary']))/2 + 20; }})
                                     .attr("y2", function(d, i) { if(d['enrolTertiary'] !== ""){return height/2;}else{return 10000;}})
                                     .attr("stroke-width", 0.25)
                                     .attr("stroke-opacity", 0.5)
                                     .attr("stroke", "LightGrey")
                                     .transition()
                                     .delay(2000)
                                     .duration(1500)
                                     .attr("x2", function(d, i) { if(d['enrolTertiary'] !== ""){ return width/2 - parseFloat(mapX3(d['enrolTertiary']))/2 + 20;} })
                                     .attr("y2", function(d, i) { if(d['enrolTertiary'] !== ""){return height - 40;}else{return 10000;}})
                                     .remove();
                                    
                    var primary1 = funnelGroup3
                                    .append("circle")
                                    .attr("class", "funnelGroup3")
                                    .attr('cx', function(d, i) { return width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20;})
                                    .attr('cy', 20)
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3)
                                    .transition()
                                    .delay(500)
                                    .duration(1500)
                                    .attr('cy', height/2)
                                    .attr('cx', function(d, i) { return width/2 + parseFloat(mapX2(d['enrolSecondary']))/2 - 20;})
                                    .transition()
                                    .duration(1500)
                                    .attr('cy', height - 40)
                                    .attr('cx', function(d, i) { return width/2 + parseFloat(mapX3(d['enrolTertiary']))/2 - 20;})
                                    .remove();
                    
                    var primary2 = funnelGroup3
                                    .append("circle")
                                    .attr("class", "funnelGroup3")
                                    .attr('cx', function(d, i) { return width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20;})
                                    .attr('cy', 20)
                                    .attr('r', 6)
                                    .attr('fill', '#27bde2')
                                    .attr('fill-opacity', 0.3)
                                    .transition()
                                    .delay(500)
                                    .duration(1500)
                                    .attr('cy', height/2)
                                    .attr('cx', function(d, i) { return width/2 - parseFloat(mapX2(d['enrolSecondary']))/2 + 20;})
                                    .transition()
                                    .duration(1500)
                                    .attr('cy', height - 40)
                                    .attr('cx', function(d, i) { return width/2 - parseFloat(mapX3(d['enrolTertiary']))/2 + 20;})
                                    .remove(); 
                                    
                                    
                // Over the past decade, the primary school enrolment rate has significantly improved in sub-Saharan Africa, now averaging over 80%.
                // However, the poor secondary and tertiary enrolment rates are considerably restricting the region from moving it's eceonomy toward higher-productivity sectors. 
                  
              });
              
              setTimeout(function() {
                 firstVisual(); }, 3500);
              
                // firstVisual();              
                 
             }
             
            function changeVisual(data){ 
                
                d3.selectAll(".funnelGroup").remove();
            
                var funnelGroup = canvas.selectAll('.funnelGroup')
                                    .data(data)
                                    .enter()
                                    .append('g'); 
            
            var a = function(d, i) { return width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20;};
            console.log(" a = " + a);
            var b = function(d, i) { return (width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20 - width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20);};
            console.log(" b = " + b);
            var c =  a - b;
            console.log(" c = " + c);
            
                var primary1 = funnelGroup
                                .append("circle")
                                .attr("class", "funnelGroup")
                                .attr('cx', function(d, i) { return width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20;})
                                .attr('cy', 20)
                                .attr('r', 6)
                                .attr('fill', 'yellow')
                                .attr('fill-opacity', 0.3);
                var primary2 = funnelGroup
                                .append("circle")
                                .attr("class", "funnelGroup")
                                .attr('cx', function(d, i) { return width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20;})
                                .attr('cy', 20)
                                .attr('r', 6)
                                .attr('fill', 'yellow')
                                .attr('fill-opacity', 0.3);
                                
                var check = funnelGroup
                                .append("rect")
                                .attr("class", "funnelGroup")
                                .attr('x', function(d, i) { return width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20;})
                                .attr('y', 18.75)
                                .attr('width', function(d, i) { return (width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20 - (width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20));})
                                .attr('height', 2.5)
                                .style("fill", "yellow")
                                .attr('fill-opacity', 0)
                                ;
        
            
                var secondary1 = funnelGroup
                                .append("circle")
                                .attr("class", "funnelGroup")
                                .attr('cx', function(d, i) { if(d['enrolSecondary'] !== ""){return width/2 + parseFloat(mapX2(d['enrolSecondary']))/2 - 20;}})
                                .attr('cy', function(d, i) { if(d['enrolSecondary'] !== ""){return height/2;}else{return 10000;}})
                                .attr('r', 6)
                                .attr('fill', 'yellow')
                                .attr('fill-opacity', 0.3); 
                var secondary2 = funnelGroup
                                .append("circle")
                                .attr("class", "funnelGroup")
                                .attr('cx', function(d, i) { if(d['enrolSecondary'] !== ""){return width/2 - parseFloat(mapX2(d['enrolSecondary']))/2 + 20;}})
                                .attr('cy', function(d, i) { if(d['enrolSecondary'] !== ""){return height/2;}else{return 10000;}})
                                .attr('r', 6)
                                .attr('fill', 'yellow')
                                .attr('fill-opacity', 0.3);                 
            
                var primSec1 = funnelGroup
                                .append("line")
                                .attr("class", "funnelGroup")
                                .attr("x1", function(d, i) { if(d['enrolSecondary'] !== ""){return width/2 + parseFloat(mapX1(d['enrolPrimary']))/2 - 20; }})
                                .attr("y1", function(d, i) { if(d['enrolSecondary'] !== ""){return 20;}else{return 10000;}})
                                .attr("x2", function(d, i) { if(d['enrolSecondary'] !== ""){return width/2 + parseFloat(mapX2(d['enrolSecondary']))/2 - 20;}})
                                .attr("y2", function(d, i) { if(d['enrolSecondary'] !== ""){return height/2;}else{return 10000;}})
                                .attr("stroke-width", 2)
                                .attr("stroke-opacity", 0.2)
                                .attr("stroke", "yellow");
                                
                var primSec2 = funnelGroup
                                .append("line")
                                .attr("class", "funnelGroup")
                                .attr("x1", function(d, i) { if(d['enrolSecondary'] !== ""){return width/2 - parseFloat(mapX1(d['enrolPrimary']))/2 + 20; }})
                                .attr("y1", function(d, i) { if(d['enrolSecondary'] !== ""){return 20;}else{return 10000;}})
                                .attr("x2", function(d, i) { if(d['enrolSecondary'] !== ""){return width/2 - parseFloat(mapX2(d['enrolSecondary']))/2 + 20;}})
                                .attr("y2", function(d, i) { if(d['enrolSecondary'] !== ""){return height/2;}else{return 10000;}} )
                                .attr("stroke-width", 2)
                                .attr("stroke-opacity", 0.2)
                                .attr("stroke", "yellow")
                                ;
                                
                var tertiary1 = funnelGroup
                                .append("circle")
                                .attr("class", "funnelGroup")
                                .attr('cx', function(d, i) { if(d['enrolTertiary'] !== ""){return width/2 + parseFloat(mapX3(d['enrolTertiary']))/2 - 20;}})
                                .attr('cy', function(d, i) { if(d['enrolTertiary'] !== ""){return height - 40;}else{return 10000;}})
                                .attr('r', 6)
                                .attr('fill', 'yellow')
                                .attr('fill-opacity', 0.3);
                var tertiary2 = funnelGroup
                                .append("circle")
                                .attr("class", "funnelGroup")
                                .attr('cx', function(d, i) { if(d['enrolTertiary'] !== ""){return width/2 - parseFloat(mapX3(d['enrolTertiary']))/2 + 20;}})
                                .attr('cy', function(d, i) { if(d['enrolTertiary'] !== ""){return height - 40;}else{return 10000;}})
                                .attr('r', 6)
                                .attr('fill', 'yellow')
                                .attr('fill-opacity', 0.3);                
                                
                                
                var secTer1 = funnelGroup
                                .append("line")
                                .attr("class", "funnelGroup")
                                .attr("x1", function(d, i) { if(d['enrolTertiary'] !== ""){return width/2 + parseFloat(mapX2(d['enrolSecondary']))/2 - 20; }})
                                .attr("y1", function(d, i) { if(d['enrolTertiary'] !== ""){return height/2;}else{return 10000;}})
                                .attr("x2", function(d, i) {  if(d['enrolTertiary'] !== ""){return width/2 + parseFloat(mapX3(d['enrolTertiary']))/2 - 20;}} )
                                .attr("y2", function(d, i) { if(d['enrolTertiary'] !== ""){return height - 40;}else{return 10000;}})
                                .attr("stroke-width", 2)
                                .attr("stroke-opacity", 0.2)
                                .attr("stroke", "yellow")
                                ;
                                
                var secTer2 = funnelGroup
                                .append("line")
                                .attr("class", "funnelGroup")
                                .attr("x1", function(d, i) { if(d['enrolTertiary'] !== ""){return width/2 - parseFloat(mapX2(d['enrolSecondary']))/2 + 20; }})
                                .attr("y1", function(d, i) { if(d['enrolTertiary'] !== ""){return height/2;}else{return 10000;}})
                                .attr("x2", function(d, i) { if(d['enrolTertiary'] !== ""){return width/2 - parseFloat(mapX3(d['enrolTertiary']))/2 + 20;} })
                                .attr("y2", function(d, i) { if(d['enrolTertiary'] !== ""){return height - 40;}else{return 10000;}})
                                .attr("stroke-width", 2)
                                .attr("stroke-opacity", 0.2)
                                .attr("stroke", "yellow")
                                ;
                                
                var tooltip =  funnelGroup
                                 .on("click", function(d) { 
                                        
                                $("#graph1").empty();
                                $("#graph2").empty();
                                $("#graph3").empty();
                                $("#graph4").empty();
                                // $("#graph5").empty();
  
                                var ttwidth = width - 100;
                                var graphWidth = ttwidth/4;
                                                    
                                d3.select("#country")
                                        .attr("x", (ttwidth)/2)
                                        .attr("y", 5)
                                        .text(d['country'] + ": change over time");
                                        
                                var mapygraph1 = d3.scaleLinear().domain([0, 100]).range([7*(graphWidth/8), graphWidth/8]);
                                var mapygraph2 = d3.scaleLinear().domain([0, 100]).range([7*(graphWidth/8), graphWidth/8]);   
                                var mapygrpah3 = d3.scaleLinear().domain([0, 100]).range([7*(graphWidth/8), graphWidth/8]); 
                                var mapygraph4 = d3.scaleLinear().domain([25, 75]).range([7*(graphWidth/8), graphWidth/8]);
                                
                                for(var i = 1; i<=4; i++)
                                {
                                    var id = "#graph" + i;
                                    
                                d3.select(id)
                                        .attr("width", graphWidth)
                                        .attr("height", graphWidth);
                                
                                d3.select(id)
                                        .append("line")
                                        .attr("x1", graphWidth/8)
                                        .attr("y1", graphWidth/8)
                                        .attr("x2", (graphWidth/8)*7)
                                        .attr("y2", graphWidth/8)
                                        .attr('stroke', '#eaeaea')
                                        .attr('stroke-width', 2);
                                d3.select(id)
                                        .append("line")
                                        .attr("x1", graphWidth/8 )
                                        .attr("y1", graphWidth/8 + 2*(graphWidth/8))
                                        .attr("x2", (graphWidth/8)*7)
                                        .attr("y2", graphWidth/8 + 2*(graphWidth/8))
                                        .attr('stroke', '#eaeaea')
                                        .attr('stroke-width', 2);
                                d3.select(id)
                                        .append("line")
                                        .attr("x1", graphWidth/8)
                                        .attr("y1", graphWidth/8 + 4*(graphWidth/8))
                                        .attr("x2", (graphWidth/8)*7)
                                        .attr("y2", graphWidth/8 + 4*(graphWidth/8))
                                        .attr('stroke', '#eaeaea')
                                        .attr('stroke-width', 2);
                                d3.select(id)
                                        .append("line")
                                        .attr("x1", graphWidth/8)
                                        .attr("y1", graphWidth/8 + 6*(graphWidth/8))
                                        .attr("x2", (graphWidth/8)*7)
                                        .attr("y2", graphWidth/8 + 6*(graphWidth/8))
                                        .attr('stroke', '#eaeaea')
                                        .attr('stroke-width', 2);    
                                       
                                d3.select(id)
                                        .append("line")
                                        .attr("x1", graphWidth/8)
                                        .attr("y1", graphWidth/8)
                                        .attr("x2", graphWidth/8)
                                        .attr("y2", graphWidth/8 + 6*(graphWidth/8))
                                        .attr('stroke', '#eaeaea')
                                        .attr('stroke-width', 2);
                                d3.select(id)
                                        .append("line")
                                        .attr("x1", graphWidth/8 + 2*(graphWidth/8))
                                        .attr("y1", graphWidth/8 )
                                        .attr("x2", (graphWidth/8) + 2*(graphWidth/8))
                                        .attr("y2", graphWidth/8 + 6*(graphWidth/8))
                                        .attr('stroke', '#eaeaea')
                                        .attr('stroke-width', 2);
                                d3.select(id)
                                        .append("line")
                                        .attr("x1", graphWidth/8 + 4*(graphWidth/8))
                                        .attr("y1", graphWidth/8)
                                        .attr("x2", graphWidth/8 + 4*(graphWidth/8))
                                        .attr("y2", graphWidth/8 + 6*(graphWidth/8))
                                        .attr('stroke', '#eaeaea')
                                        .attr('stroke-width', 2);
                                d3.select(id)
                                        .append("line")
                                        .attr("x1", graphWidth/8 + 6*(graphWidth/8))
                                        .attr("y1", graphWidth/8)
                                        .attr("x2", graphWidth/8 + 6*(graphWidth/8))
                                        .attr("y2", graphWidth/8 + 6*(graphWidth/8))
                                        .attr('stroke', '#eaeaea')
                                        .attr('stroke-width', 2);  
                                
                                d3.select(id)
                                        .append("text")
                                        .attr("class", "label")
                                        .attr("x", graphWidth/8)
                                        .attr("y", 7*(graphWidth/8) + 15)
                                        .text("'90-'95")
                                        .attr("text-anchor", "middle");
                                d3.select(id)
                                        .append("text")
                                        .attr("class", "label")
                                        .attr("x", 7*(graphWidth/8))
                                        .attr("y", 7*(graphWidth/8) + 15)
                                        .text("'06-'10")
                                        .attr("text-anchor", "middle");                                
                                        
                                }
                                
                                    
                                d3.select("#graph1")
                                        .append("text")
                                        .attr("class", "graphTitle")
                                        .attr("x", graphWidth/2)
                                        .attr("y", 20)
                                        .text("primary enrollment rate")
                                        .attr("text-anchor", "middle");
                                
                                d3.select("#graph2")
                                        .append("text")
                                        .attr("class", "graphTitle")
                                        .attr("x", graphWidth/2)
                                        .attr("y", 20)
                                        .text("secondary enrollment rate")
                                        .attr("text-anchor", "middle");
                                d3.select("#graph3")
                                        .append("text")
                                        .attr("class", "graphTitle")
                                        .attr("x", graphWidth/2)
                                        .attr("y", 20)
                                        .text("tertiary enrollment rate")
                                        .attr("text-anchor", "middle"); 
                                d3.select("#graph4")
                                        .append("text")
                                        .attr("class", "graphTitle")
                                        .attr("x", graphWidth/2)
                                        .attr("y", 20)
                                        .text("inequality (GINI)")
                                        .attr("text-anchor", "middle"); 
                                // d3.select("#graph5")
                                //         .append("text")
                                //         .attr("class", "graphTitle")
                                //         .attr("x", graphWidth/2)
                                //         .attr("y", 20)
                                //         .text("poverty")
                                //         .attr("text-anchor", "middle"); 
                        
                        if(d['pri9195'] == "" && d['pri0610'] == ""){
                            
                            d3.select("#graph1")
                                        .append("text")
                                        .attr("class", "nodata")
                                        .text("No Data")
                                        .attr('x', graphWidth/2)
                                        .attr('y', graphWidth/2 + 5)
                                        .style("fill", "LightGrey")
                                        .attr("text-anchor", "middle");    
                        }
                        
                        if(d['sec9195'] == "" && d['sec0610'] == ""){
                             d3.select("#graph2")
                                        .append("text")
                                        .attr("class", "nodata")
                                        .text("No Data")
                                        .attr('x', graphWidth/2)
                                        .attr('y', graphWidth/2 + 5)
                                        .style("fill", "LightGrey")
                                        .attr("text-anchor", "middle");   
                        }
                        
                        if(d['ter9195'] == "" && d['ter0610'] == ""){
                             d3.select("#graph3")
                                        .append("text")
                                        .attr("class", "nodata")
                                        .text("No Data")
                                        .attr('x', graphWidth/2)
                                        .attr('y', graphWidth/2 + 5)
                                        .style("fill", "LightGrey")
                                        .attr("text-anchor", "middle");   
                        }
                        
                        if(d['gini9195'] == "" && d['gini0610'] == ""){
                             d3.select("#graph4")
                                        .append("text")
                                        .attr("class", "nodata")
                                        .text("No Data")
                                        .attr('x', graphWidth/2)
                                        .attr('y', graphWidth/2 + 5)
                                        .style("fill", "LightGrey")
                                        .attr("text-anchor", "middle");   
                        }
                        
                        if(d['pri9195'] !== "" && d['pri0610'] !== ""){  
                       
                        var line1 = d3.select("#graph1")
                                    .append("line")
                                    .attr("x1", graphWidth/8)
                                    .attr("y1", mapygraph1(d['pri9195']))
                                    .attr("x2", 7*(graphWidth/8))
                                    .attr("y2", mapygraph1(d['pri0610']))
                                    .attr('stroke', '#27bde2')
                                    .attr('stroke-width', 2);
                        }
                        
                        if(d['pri9195'] !== ""){
                        var circle1a = d3.select("#graph1")
                                        .append("circle")
                                        .attr("cx", graphWidth/8)
                                        .attr('cy', mapygraph1(d['pri9195']))
                                        .attr('r', 5)
                                        .attr('fill', '#27bde2')
                                        .attr('stroke', 'white')
                                        .attr('stroke-width', 2);
                        
                        var text1a = d3.select("#graph1")
                                        .append("text")
                                        .attr('class', 'label2')
                                        .text(d['pri9195'] + "%")
                                        .attr('x', graphWidth/8 - 15)
                                        .attr('y', mapygraph1(d['pri9195']) - 15);
                                        
                        }
                        
                        if(d['pri0610'] !== ""){
                        var circle1b = d3.select("#graph1")
                                        .append("circle")
                                        .attr("cx", 7*(graphWidth/8))
                                        .attr('cy', mapygraph1(d['pri0610']))
                                        .attr('r', 5)
                                        .attr('fill', '#27bde2')
                                        .attr('stroke', 'white')
                                        .attr('stroke-width', 2);
                                        
                        var text1b = d3.select("#graph1")
                                        .append("text")
                                        .attr('class', 'label2')
                                        .text(d['pri0610'] + "%")
                                        .attr('x', 7*(graphWidth/8) - 15)
                                        .attr('y', mapygraph1(d['pri0610']) - 15);
                                        
                        }            
                        
                        if(d['sec9195'] !== "" && d['sec0610'] !== ""){
                        var line2 = d3.select("#graph2")
                                    .append("line")
                                    .attr("x1", graphWidth/8)
                                    .attr("y1", mapygraph1(d['sec9195']))
                                    .attr("x2", 7*(graphWidth/8))
                                    .attr("y2", mapygraph1(d['sec0610']))
                                    .attr('stroke', '#27bde2')
                                    .attr('stroke-width', 2);            
                        }
                        
                        if(d['sec9195'] !== ""){
                        var circle2a = d3.select("#graph2")
                                        .append("circle")
                                        .attr("cx", graphWidth/8)
                                        .attr('cy', mapygraph1(d['sec9195']))
                                        .attr('r', 5)
                                        .attr('fill', '#27bde2')
                                        .attr('stroke', 'white')
                                        .attr('stroke-width', 2);
                        
                        var text2a = d3.select("#graph2")
                                        .append("text")
                                        .attr('class', 'label2')
                                        .text(d['sec9195'] + "%")
                                        .attr('x', (graphWidth/8) - 15)
                                        .attr('y', mapygraph1(d['sec9195']) - 15);                
                                        
                        }
                        
                        if(d['sec0610'] !== ""){
                        var circle2b = d3.select("#graph2")
                                        .append("circle")
                                        .attr("cx", 7*(graphWidth/8))
                                        .attr('cy', mapygraph1(d['sec0610']))
                                        .attr('r', 5)
                                        .attr('fill', '#27bde2')
                                        .attr('stroke', 'white')
                                        .attr('stroke-width', 2);
                        
                        var text2b = d3.select("#graph2")
                                        .append("text")
                                        .attr('class', 'label2')
                                        .text(d['sec0610'] + "%")
                                        .attr('x', 7*(graphWidth/8) - 15)
                                        .attr('y', mapygraph2(d['sec0610']) - 15);                   
                        }
                        
                        if(d['ter9195'] !== "" && d['ter0610'] !== ""){
                        var line3 = d3.select("#graph3")
                                    .append("line")
                                    .attr("x1", graphWidth/8)
                                    .attr("y1", mapygraph1(d['ter9195']))
                                    .attr("x2", 7*(graphWidth/8))
                                    .attr("y2", mapygraph1(d['ter0610']))
                                    .attr('stroke', '#27bde2')
                                    .attr('stroke-width', 2);
                        }
                        
                        if(d['ter9195'] !== ""){
                        var circle3a = d3.select("#graph3")
                                        .append("circle")
                                        .attr("cx", graphWidth/8)
                                        .attr('cy', mapygraph1(d['ter9195']))
                                        .attr('r', 5)
                                        .attr('fill', '#27bde2')
                                        .attr('stroke', 'white')
                                        .attr('stroke-width', 2);
                        
                        var text3a = d3.select("#graph3")
                                        .append("text")
                                        .attr('class', 'label2')
                                        .text(d['ter9195'] + "%")
                                        .attr('x', (graphWidth/8) - 15)
                                        .attr('y', mapygraph1(d['ter9195']) - 15);                     
                        
                                        
                        }
                        if(d['ter0610'] != ""){
                        var circle3b = d3.select("#graph3")
                                        .append("circle")
                                        .attr("cx", 7*(graphWidth/8))
                                        .attr('cy', mapygraph1(d['ter0610']))
                                        .attr('r', 5)
                                        .attr('fill', '#27bde2')
                                        .attr('stroke', 'white')
                                        .attr('stroke-width', 2);
                         
                        var text3b = d3.select("#graph3")
                                        .append("text")
                                        .attr('class', 'label2')
                                        .text(d['ter0610'] + "%")
                                        .attr('x', 7*(graphWidth/8) - 15)
                                        .attr('y', mapygraph1(d['ter0610']) - 15);                     
                        
                                        
                        }                
                                    
                        if(d['gini9195'] !== "" && d['gini0610'] !== ""){
                        var line3 = d3.select("#graph4")
                                    .append("line")
                                    .attr("x1", graphWidth/8)
                                    .attr("y1", mapygraph4(d['gini9195']))
                                    .attr("x2", 7*(graphWidth/8))
                                    .attr("y2", mapygraph4(d['gini0610']))
                                    .attr('stroke', '#fcc30b')
                                    .attr('stroke-width', 2);
                        }
                        
                        if(d['gini9195'] !== ""){
                        var circle4a = d3.select("#graph4")
                                        .append("circle")
                                        .attr("cx", graphWidth/8)
                                        .attr('cy', mapygraph4(d['gini9195']))
                                        .attr('r', 5)
                                        .attr('fill', '#fcc30b')
                                        .attr('stroke', 'white')
                                        .attr('stroke-width', 2);
                        
                        var text4a = d3.select("#graph4")
                                        .append("text")
                                        .attr('class', 'label2')
                                        .text(d['gini9195'] + "%")
                                        .attr('x', (graphWidth/8) - 15)
                                        .attr('y', mapygraph4(d['gini9195']) - 15);                   
                                        
                        }
                          
                        if(d['gini0610'] !== ""){                
                        var circle4b = d3.select("#graph4")
                                        .append("circle")
                                        .attr("cx", 7*(graphWidth/8))
                                        .attr('cy', mapygraph4(d['gini0610']))
                                        .attr('r', 5)
                                        .attr('fill', '#fcc30b')
                                        .attr('stroke', 'white')
                                        .attr('stroke-width', 2); 
                        var text4b = d3.select("#graph4")
                                        .append("text")
                                        .attr('class', 'label2')
                                        .text(d['gini0610'] + "%")
                                        .attr('x', 7*(graphWidth/8) - 15)
                                        .attr('y', mapygraph4(d['gini0610']) - 15);
                                        
                                        
                        }        
                                $(".btn.close").on("click",function(){
			                    	$("#myModal").fadeOut();
			                            })
                                        
                                $("#myModal").fadeIn(); })
                                     
 
                                // .on("mouseclick", function(){ alert(" HI "); })
                                .on("mouseover", function(d) 
                                    {
                                    d3.select(this).selectAll("circle").style("stroke", 'rgb(180, 180, 180)').style("stroke-width", "2.5").style("fill-opacity", "1"); // d3.select(this).selectAll("#funnelLine").style("stroke-width", "2");
                                    d3.select(this).selectAll("line").style("stroke-width", "2.5").style("stroke-opacity", "1"); 
                                    d3.select(this).selectAll("rect").style("fill-opacity", "1"); 
                                    div.transition()		
                                        .duration(200)		
                                        .style("opacity", .9);
                                    
                                    var primColor, secColor, terColor;
                                    if(d['enrolPrimary'] >= 91.97){primColor = 'green';}else{ primColor = 'red'};
                                    if(d['enrolSecondary'] >= d['enrolSecondaryAvg']){secColor = 'green';}else{ secColor = 'red'};
                                    if(d['enrolTertiary'] >= 8.39){terColor = 'green';}else{ terColor = 'red'};
                                        
                                    div.html("<span style='font-size: 15px; text-align: left; text-transform: uppercase'>" + "<b>" + d['country'] + "</b> </span> <br>" 
                                                         // + "</span>" + "<br>" + "<span> <br> Primary:   </span>"+  "<b>"+ "<span style = 'color: " + primColor + "'>"  + d['enrolPrimary'] + "%" +  " </span> </b>"
                                                          + "<br>" + " Primary:  <b>" + "<span style='color: " + primColor + "'>" + d['enrolPrimary'] + "%" + "</span> </b>"
                                                          + "<br>" + " Secondary:  <b>" + "<span style='color: " + secColor + "'>" + d['enrolSecondary'] + "%" + "</span> </b>"
                                                          + "<br>" + " Tertiary: <b>" + "<span style='color: " + terColor + "'>" + d['enrolTertiary'] + "%" + "</span> </b>")	
                                        .style("left", (d3.event.pageX - 80) + "px")		
                                        .style("top", (d3.event.pageY - 130) + "px");
                                    })
                                .on("mouseout", function() {
                                    d3.select(this).selectAll("circle").style("stroke", 'white').style("stroke-width", "0").style("fill-opacity", "0.3");
                                    //d3.select(this).selectAll("#funnelLine").style("stroke-width", "0.3").style("stroke-opacity", "0").style("stroke", "yellow");
                                    d3.select(this).selectAll("line").style("stroke-width", "0.3").style("stroke-opacity", "0.5").style("stroke", "yellow");
                                    d3.select(this).selectAll("rect").style("fill-opacity", "0");
                                    
                                    
                                    div.transition()		
                                        .duration(500)		
                                        .style("opacity", 0);	
                                });
                                    
                
            }
        </script>
    </body>
</html>


<!---->